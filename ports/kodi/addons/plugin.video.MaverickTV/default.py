import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0NCmltcG9ydCB1cmxsaWINCmltcG9ydCB1cmxsaWIyDQppbXBvcnQgZGF0ZXRpbWUNCmltcG9ydCByZQ0KaW1wb3J0IG9zDQppbXBvcnQgYmFzZTY0DQppbXBvcnQgeGJtY3BsdWdpbg0KaW1wb3J0IHhibWNndWkNCmltcG9ydCB4Ym1jYWRkb24NCmltcG9ydCB4Ym1jdmZzDQppbXBvcnQgdHJhY2ViYWNrDQppbXBvcnQgY29va2llbGliDQpmcm9tIEJlYXV0aWZ1bFNvdXAgaW1wb3J0IEJlYXV0aWZ1bFN0b25lU291cCwgQmVhdXRpZnVsU291cCwgQmVhdXRpZnVsU09BUA0KdHJ5Og0KICAgIGltcG9ydCBqc29uDQpleGNlcHQ6DQogICAgaW1wb3J0IHNpbXBsZWpzb24gYXMganNvbg0KaW1wb3J0IHRpbWUNCmltcG9ydCByZXF1ZXN0cw0KaW1wb3J0IF9FZGl0DQoNCk5mbCA9ICcnDQpGb290YmFsbCA9ICcnDQpDcmlja2V0ID0gJycNClRlbm5pcyA9ICcnIA0KQm94aW5nID0gJycNCkdvbGYgPSAnJw0KTW90b3JzcG9ydHMgPSAnJw0KUnVnYnkgPSAnJw0KSG9ja2V5ID0gJycNCk5iYSA9ICcnDQpEYXJ0cyA9ICcnDQpXd2UgPSAnJw0KSG9yc2VfUmFjaW5nID0gJycNClVmYyA9ICcnDQpCYXNlYmFsbCA9ICcnDQoJDQpyZXNvbHZlX3VybD1bJzFmaWNoaWVyLmNvbScsICdhbGxkZWJyaWQuY29tJywgJ2FsbG15dmlkZW9zLm5ldCcsICdhbGx2aWQuY2gnLCAnYXVlbmdpbmUuY29tJywgJ2Jlc3RzdHJlYW1zLm5ldCcsICdicmlza2ZpbGUuY29tJywgJ2Nhc3RhbXAuY29tJywgJ2NsaWNrbnVwbG9hZC5jb20nLCAnY2xpY2tudXBsb2FkLm1lJywgJ2NsaWNrbnVwbG9hZC5saW5rJywgJ2Nsb3VkeS5lYycsICdjbG91ZHppbGxhLnRvJywgJ25lb2RyaXZlLmNvJywgJ2NydW5jaHlyb2xsLmNvbScsICdkYWNsaXBzLmluJywgJ2RhY2xpcHMuY29tJywgJ2RhaWx5bW90aW9uLmNvbScsICdkaXZ4c3RhZ2UuZXUnLCAnZGl2eHN0YWdlLm5ldCcsICdkaXZ4c3RhZ2UudG8nLCAnY291bGR0aW1lLnRvJywgJ2Vjb3N0cmVhbS50dicsICdleGFzaGFyZS5jb20nLCAnZXN0cmVhbS50bycsICdmYWNlYm9vay5jb20nLCAnZmFzdHBsYXkuY2MnLCAnZmFzdHBsYXkudG8nLCAnZmFzdHBsYXkuc3gnLCAnZmlsZWhvb3QuY29tJywgJ2ZpbGVudWtlLmNvbScsICdmaWxlcHVwLm5ldCcsICdmaWxtc2hvd29ubGluZS5uZXQnLCAnZmxhc2h4LnR2JywgJ3BsdXMuZ29vZ2xlLmNvbScsICdnb29nbGV2aWRlby5jb20nLCAncGljYXNhd2ViLmdvb2dsZS5jb20nLCAnZ29vZ2xldXNlcmNvbnRlbnQuY29tJywgJ2dvb2dsZWRyaXZlLmNvbScsICdnb3JpbGxhdmlkLmluJywgJ2dvcmlsbGF2aWQuY29tJywgJ2dvcmlsbGF2aWQuaW4nLCAnZ3JpZnRob3N0LmNvbScsICdodWdlZmlsZXMubmV0JywgJ2lkb3dhdGNoLm5ldCcsICdpbmRhdmlkZW8uaHUnLCAnaXNoYXJlZC5ldScsICdqZXRsb2FkLnR2JywgJ2tpbmdmaWxlcy5uZXQnLCAnbGV0d2F0Y2gudXMnLCAnbGV0d2F0Y2gudG8nLCAndmlkc2hhcmUudXMnLCAnbWFpbC5ydScsICdteS5tYWlsLnJ1JywgJ3ZpZGVvYXBpLm15Lm1haWwucnUnLCAnYXBpLnZpZGVvLm1haWwucnUnLCAnbWVnYS1kZWJyaWQuZXUnLCAnbWVnYW1wNC5uZXQnLCAnbWVyc2FsYWF5aXR0ZW4uY29tJywgJ21vdmRpdnguY29tJywgJ21vdnBvZC5uZXQnLCAnbW92cG9kLmluJywgJ21vdnNoYXJlLm5ldCcsICd3aG9sZWNsb3VkLm5ldCcsICdtcDRlbmdpbmUuY29tJywgJ21wNHN0cmVhbS5jb20nLCAnbXA0dXBsb2FkLmNvbScsICdteXZpZHN0cmVhbS5uZXQnLCAnbm9zdmlkZW8uY29tJywgJ25vc2xvY2tlci5jb20nLCAnYXVyb3JhdmlkLnRvJywgJ25vdmFtb3YuY29tJywgJ25vd3ZpZGVvLnN4JywgJ25vd3ZpZGVvLmV1JywgJ25vd3ZpZGVvLmNoJywgJ25vd3ZpZGVvLnN4JywgJ25vd3ZpZGVvLmNvJywgJ25vd3ZpZGVvLmxpJywgJ25vd3ZpZGVvLmVjJywgJ25vd3ZpZGVvLmF0JywgJ25vd3ZpZGVvLmZvJywgJ29rLnJ1JywgJ29kbm9rbGFzc25pa2kucnUnLCAnb3BlbmxvYWQuaW8nLCAnb3BlbmxvYWQuY28nLCAncGxheTQ0Lm5ldCcsICdwbGF5ZWQudG8nLCAncGxheWhkLnZpZGVvJywgJ3BsYXloZC5mbycsICdwbGF5dS5uZXQnLCAncGxheXUubWUnLCAncGxheXdpcmUuY29tJywgJ1ByZW1pdW1pemUubWUnLCAncHJpbWVzaGFyZS50dicsICdwcm9tcHRmaWxlLmNvbScsICdwdXJldmlkLmNvbScsICdyYXBpZHZpZGVvLndzJywgJ3JhcGlkdmlkZW8uY29tJywgJ2FwaS5yZWFsLWRlYnJpZC5jb20nLCAncHJlbWl1bS5ycG5ldC5iaXonLCAncnV0dWJlLnJ1JywgJ3NoYXJlZDIubWUnLCAnc2hhcmVkLnN4JywgJ3NoYXJlcmVwby5jb20nLCAnc2hhcmVzaXguY29tJywgJ3NpbXBseS1kZWJyaWQuY29tJywgJ3NwZWVkcGxheS54eXonLCAnc3BlZWRwbGF5LnVzJywgJ3NwZWVkcGxheTMucHcnLCAnc3BlZWR2aWRlby5uZXQnLCAnc3RhZ2V2dS5jb20nLCAnc3RyZWFtY2xvdWQuZXUnLCAnc3RyZWFtaW4udG8nLCAnc3RyZWFtLm1vZScsICdzdHJlYW1hbmdvLmNvbScsICdzdHJlYW1jaGVycnkuY29tJywgJ3RlcmFtaXhlci5jb20nLCAndGhldmlkZW8ubWUnLCAndGhldmlkZW9zLnR2JywgJ3RvbHRzZC1mZWwudGsnLCAndHJvbGx2aWQubmV0JywgJ3R1bmUucGsnLCAndHVzZmlsZXMubmV0JywgJ3R3aXRjaC50dicsICd1cDJzdHJlYW0uY29tJywgJ3VwbG9hZC5hZicsICd1cGxvYWRjLmNvbScsICd1cGxvYWRjLmNoJywgJ3phbGFhLmNvbScsICd1cGxvYWR4Lm9yZycsICd1cHRvYm94LmNvbScsICd1cHRvc3RyZWFtLmNvbScsICd1c2VyZmlsZXMuY29tJywgJ3VzZXJzY2xvdWQuY29tJywgJ3ZlZWhkLmNvbScsICd2ZW9oLmNvbScsICd2aWQuYWcnLCAndmlkYnVsbC5jb20nLCAndmlkY3JhenkubmV0JywgJ3VwbG9hZGNyYXp5Lm5ldCcsICd0aGV2aWRlb2JlZS50bycsICd2aWRlb2JveGVyLmNvJywgJ3ZpZGdnLnRvJywgJ3ZpZC5nZycsICd2aWRlb2h1dC50bycsICd2aWRlb21lZ2EudHYnLCAndmlkZW9yYWoudG8nLCAndmlkZW9yZXYuY2MnLCAndmlkZW9za3kudG8nLCAndmlkZW8udHQnLCAndmlkZW93ZWVkLmVzJywgJ2JpdHZpZC5zeCcsICd2aWRlb3dlZWQuY29tJywgJ3ZpZGVvd29vZC50dicsICdieXpvby5vcmcnLCAncGxheXBhbmRhLm5ldCcsICd2aWRlb3pvby5tZScsICd2aWRlb3dpbmcubWUnLCAndmlkZW93aW5nLm1lJywgJ2Vhc3l2aWRlby5tZScsICdwbGF5NDQubmV0JywgJ3BsYXliYi5tZScsICd2aWRlbzQ0Lm5ldCcsICd2aWRpby5zeCcsICd2aWRsb3gudHYnLCAndmlkLm1lJywgJ3ZpZHNwb3QubmV0JywgJ3ZpZHRvLm1lJywgJ3ZpZHVwLm1lJywgJ3ZpZHVwLm9yZycsICd2aWR6aS50dicsICd2aW1lby5jb20nLCAndml2by5zeCcsICd2ay5jb20nLCAndmtwYXNzLmNvbScsICd2b2Rsb2NrZXIuY29tJywgJ3ZzaGFyZS5pbycsICd2c2hhcmUuZXUnLCAnd2F0Y2hlcnMudG8nLCAnd2F0Y2hvbmxpbmUudG8nLCAnd2F0Y2h2aWRlby51cycsICd3YXRjaHZpZGVvMi51cycsICd3YXRjaHZpZGVvMy51cycsICd3YXRjaHZpZGVvNC51cycsICd3YXRjaHZpZGVvNS51cycsICd3YXRjaHZpZGVvNi51cycsICd3YXRjaHZpZGVvNy51cycsICd3YXRjaHZpZGVvOC51cycsICd3YXRjaHZpZGVvOS51cycsICd3ZXNoYXJlLm1lJywgJ3h2aWRzdGFnZS5jb20nLCAneW91bG9sLmJpeicsICdzaGl0bW92aWUuY29tJywgJ3lvdXJ1cGxvYWQuY29tJywgJ3lvdXR1YmUuY29tJywgJ3lvdXR1LmJlJywgJ3lvdXdhdGNoLm9yZycsICdhcGkuemV2ZXJhLmNvbScsICd6ZXR0YWhvc3QudHYnLCAnenN0cmVhbS50byddDQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10NCg0KY2xhc3MgTm9SZWRpcmVjdGlvbih1cmxsaWIyLkhUVFBFcnJvclByb2Nlc3Nvcik6DQogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6DQogICAgICAgcmV0dXJuIHJlc3BvbnNlDQogICBodHRwc19yZXNwb25zZSA9IGh0dHBfcmVzcG9uc2UNCiAgICAgICANCmFkZG9uID0gX0VkaXQuYWRkb24NCmFkZG9uX3ZlcnNpb24gPSBhZGRvbi5nZXRBZGRvbkluZm8oJ3ZlcnNpb24nKQ0KcHJvZmlsZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3Byb2ZpbGUnKS5kZWNvZGUoJ3V0Zi04JykpDQpob21lID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncGF0aCcpLmRlY29kZSgndXRmLTgnKSkNCmZhdm9yaXRlcyA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnZmF2b3JpdGVzJykNCmhpc3RvcnkgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2hpc3RvcnknKQ0KDQpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQ0KaWNvbiA9IG9zLnBhdGguam9pbihob21lLCAnaWNvbi5wbmcnKQ0KRkFOQVJUID0gb3MucGF0aC5qb2luKGhvbWUsICdmYW5hcnQuanBnJykNCnNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdzb3VyY2VfZmlsZScpDQpmdW5jdGlvbnNfZGlyID0gcHJvZmlsZQ0KZGVidWcgPSBhZGRvbi5nZXRTZXR0aW5nKCdkZWJ1ZycpDQppZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1UcnVlOg0KICAgIEZBViA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkNCmVsc2U6IEZBViA9IFtdDQppZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6DQogICAgU09VUkNFUyA9IG9wZW4oc291cmNlX2ZpbGUpLnJlYWQoKQ0KZWxzZTogU09VUkNFUyA9IFtdDQoNCg0KZGVmIGFkZG9uX2xvZyhzdHJpbmcpOg0KICAgIGlmIGRlYnVnID09ICd0cnVlJzoNCiAgICAgICAgeGJtYy5sb2coIlthZGRvbi5saXZlLk1hdmVyaWNrIFRWIExpc3RzLSVzXTogJXMiICUoYWRkb25fdmVyc2lvbiwgc3RyaW5nKSkNCg0KDQpkZWYgbWFrZVJlcXVlc3QodXJsLCBoZWFkZXJzPU5vbmUpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnVXNlci1hZ2VudCcgOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgcnY6MTkuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xOS4wJ30NCiAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwsTm9uZSxoZWFkZXJzKQ0KICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQ0KICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgZXhjZXB0IHVybGxpYjIuVVJMRXJyb3IsIGU6DQogICAgICAgICAgICBhZGRvbl9sb2coJ1VSTDogJyt1cmwpDQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gJXMuJyAlIGUuY29kZSkNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihNYXZlcmljayBUVixXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gIitzdHIoZS5jb2RlKSsiLDEwMDAwLCIraWNvbisiKSIpDQogICAgICAgICAgICBlbGlmIGhhc2F0dHIoZSwgJ3JlYXNvbicpOg0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLicpDQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdSZWFzb246ICVzJyAlZS5yZWFzb24pDQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oTWF2ZXJpY2sgVFYsV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLiAtICIrc3RyKGUucmVhc29uKSsiLDEwMDAwLCIraWNvbisiKSIpDQoNCgkJCQkNCmRlZiBTS2luZGV4KCk6DQogICAgYWRkb25fbG9nKCJTS2luZGV4IikNCiAgICBnZXREYXRhKF9FZGl0Lk1haW5CYXNlLCcnKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCgkJDQpkZWYgT3Blbl9VcmwodXJsKToNCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQ0KICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzOyBVOyBXaW5kb3dzIE5UIDUuMTsgZW4tR0I7IHJ2OjEuOS4wLjMpIEdlY2tvLzIwMDgwOTI0MTcgRmlyZWZveC8zLjAuMycpDQogICAgcmVzcG9uc2UgPSAnJw0KICAgIGxpbmsgPSAnJw0KICAgIHRyeTogDQogICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCiAgICAgICAgbGluaz1yZXNwb25zZS5yZWFkKCkNCiAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgIGV4Y2VwdDogcGFzcw0KICAgIGlmIGxpbmsgIT0gJyc6DQogICAgICAgIHJldHVybiBsaW5rDQogICAgZWxzZToNCiAgICAgICAgbGluayA9ICdPcGVuZWQnDQogICAgICAgIHJldHVybiBsaW5rDQoJDQpkZWYgU2VhcmNoX2lucHV0KHVybCk6DQogICAgRGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQ0KICAgIFNlYXJjaF90aXRsZSA9IERpYWxvZy5pbnB1dCgnU2VhcmNoJywgdHlwZT14Ym1jZ3VpLklOUFVUX0FMUEhBTlVNKQ0KICAgIFNlYXJjaF9uYW1lID0gU2VhcmNoX3RpdGxlLmxvd2VyKCkNCiAgICBpZiBTZWFyY2hfbmFtZSA9PSAnJzoNCiAgICAgICAgcGFzcw0KICAgIGVsc2U6DQogICAgICAgIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCkgICAgDQoJDQpkZWYgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKToNCiAgICBIVE1MID0gT3Blbl9VcmwodXJsKQ0KICAgIGlmIEhUTUwgIT0gJ0ZhaWxlZCc6DQogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnPGNoYW5uZWw+Lis/PG5hbWU+KC4rPyk8L25hbWU+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxleHRlcm5hbGxpbms+KC4rPyk8L2V4dGVybmFsbGluaz4uKz88ZmFuYXJ0PiguKz8pPC9mYW5hcnQ+Lis/PC9jaGFubmVsPicscmUuRE9UQUxMKS5maW5kYWxsKEhUTUwpDQogICAgICAgIGZvciBuYW1lLGltYWdlLHVybCxmYW5hcnQgaW4gbWF0Y2g6DQogICAgICAgICAgICBpZiBub3QgJ2h0dHA6JyBpbiB1cmw6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBTZWFyY2hfbG9vcChTZWFyY2hfbmFtZSx1cmwpDQogICAgICAgIG1hdGNoMiA9IHJlLmNvbXBpbGUoJzx0aXRsZT4oLis/KTwvdGl0bGU+Lis/PGxpbms+KC4rPyk8L2xpbms+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxmYW5hcnQ+KC4rPyk8L2ZhbmFydD4nLHJlLkRPVEFMTCkuZmluZGFsbChIVE1MKQ0KICAgICAgICBmb3IgbmFtZSx1cmwsaW1hZ2UsZmFuYXJ0IGluIG1hdGNoMjoNCiAgICAgICAgICAgIGlmICdodHRwOicgaW4gdXJsOg0KICAgICAgICAgICAgICAgIGlmIFNlYXJjaF9uYW1lLmxvd2VyKCkgaW4gbmFtZS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCwgbmFtZSxpbWFnZSxmYW5hcnQsJycsJycsJycsJycsTm9uZSwnJywxKQ0KCQkNCgkJDQpkZWYgZ2V0U291cmNlcygpOg0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpID09IFRydWU6DQogICAgICAgICAgICBhZGREaXIoJ0Zhdm9yaXRlcycsJ3VybCcsNCxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpDQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV94bWxfZGF0YWJhc2UiKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICBhZGREaXIoJ1hNTCBEYXRhYmFzZScsJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nLDE1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQ0KICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJicm93c2VfY29tbXVuaXR5IikgPT0gInRydWUiOg0KICAgICAgICAgICAgYWRkRGlyKCdDb21tdW5pdHkgRmlsZXMnLCdjb21tdW5pdHlfZmlsZXMnLDE2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhoaXN0b3J5KSA9PSBUcnVlOg0KICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2ggSGlzdG9yeScsJ2hpc3RvcnknLDI1LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJ2Zhdm9yaXRlLnBuZycpLEZBTkFSVCwnJywnJywnJywnJykNCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygic2VhcmNoeXQiKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICBhZGREaXIoJ1NlYXJjaDpZb3V0dWJlJywneW91dHViZScsMjUsaWNvbixGQU5BUlQsJycsJycsJycsJycpDQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoInNlYXJjaERNIikgPT0gInRydWUiOg0KICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2g6ZGFpbHltb3Rpb24nLCdkbW90aW9uJywyNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykNCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiUHVsc2FyTSIpID09ICJ0cnVlIjoNCiAgICAgICAgICAgIGFkZERpcignUHVsc2FyOklNREInLCdJTURCaWRwbGF5JywyNyxpY29uLEZBTkFSVCwnJywnJywnJywnJykgICAgICAgICAgICANCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOg0KICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkNCiAgICAgICAgICAgICNwcmludCAnc291cmNlcycsc291cmNlcw0KICAgICAgICAgICAgaWYgbGVuKHNvdXJjZXMpID4gMToNCiAgICAgICAgICAgICAgICBmb3IgaSBpbiBzb3VyY2VzOg0KICAgICAgICAgICAgICAgICAgICAjIyBmb3IgcHJlIDEuMC44IHNvdXJjZXMNCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWzBdLmVuY29kZSgndXRmLTgnKSxpWzFdLmVuY29kZSgndXRmLTgnKSwxLGljb24sRkFOQVJULCcnLCcnLCcnLCcnLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpY29uDQogICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBGQU5BUlQNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgndGh1bWJuYWlsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpWyd0aHVtYm5haWwnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdmYW5hcnQnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpWydmYW5hcnQnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdkZXNjcmlwdGlvbicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSBpWydkZXNjcmlwdGlvbiddDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2RhdGUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gaVsnZGF0ZSddDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2dlbnJlJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBpWydnZW5yZSddDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2NyZWRpdHMnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gaVsnY3JlZGl0cyddDQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVsndGl0bGUnXS5lbmNvZGUoJ3V0Zi04JyksaVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWIsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLCdzb3VyY2UnKQ0KDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA9PSAxOg0KICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbMF0sIGxpc3QpOg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWzFdLmVuY29kZSgndXRmLTgnKSxGQU5BUlQpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRhKHNvdXJjZXNbMF1bJ3VybCddLCBzb3VyY2VzWzBdWydmYW5hcnQnXSkNCg0KDQpkZWYgYWRkU291cmNlKHVybD1Ob25lKToNCiAgICAgICAgaWYgdXJsIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X2ZpbGVfc291cmNlIikgPT0gIiI6DQogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X2ZpbGVfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpDQogICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfdXJsX3NvdXJjZSIpID09ICIiOg0KICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld191cmxfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzb3VyY2VfdXJsID0gdXJsDQogICAgICAgIGlmIHNvdXJjZV91cmwgPT0gJycgb3Igc291cmNlX3VybCBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGFkZG9uX2xvZygnQWRkaW5nIE5ldyBTb3VyY2U6ICcrc291cmNlX3VybC5lbmNvZGUoJ3V0Zi04JykpDQoNCiAgICAgICAgbWVkaWFfaW5mbyA9IE5vbmUNCiAgICAgICAgI3ByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsDQogICAgICAgIGRhdGEgPSBnZXRTb3VwKHNvdXJjZV91cmwpDQogICAgICAgIHByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsDQogICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSxCZWF1dGlmdWxTT0FQKToNCiAgICAgICAgICAgIGlmIGRhdGEuZmluZCgnY2hhbm5lbHNfaW5mbycpOg0KICAgICAgICAgICAgICAgIG1lZGlhX2luZm8gPSBkYXRhLmNoYW5uZWxzX2luZm8NCiAgICAgICAgICAgIGVsaWYgZGF0YS5maW5kKCdpdGVtc19pbmZvJyk6DQogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuaXRlbXNfaW5mbw0KICAgICAgICBpZiBtZWRpYV9pbmZvOg0KICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30NCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG1lZGlhX2luZm8udGl0bGUuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aHVtYm5haWwnXSA9IG1lZGlhX2luZm8udGh1bWJuYWlsLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBtZWRpYV9pbmZvLmZhbmFydC5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2dlbnJlJ10gPSBtZWRpYV9pbmZvLmdlbnJlLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGVzY3JpcHRpb24nXSA9IG1lZGlhX2luZm8uZGVzY3JpcHRpb24uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkYXRlJ10gPSBtZWRpYV9pbmZvLmRhdGUuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydjcmVkaXRzJ10gPSBtZWRpYV9pbmZvLmNyZWRpdHMuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGlmICcvJyBpbiBzb3VyY2VfdXJsOg0KICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCcvJylbLTFdLnNwbGl0KCcuJylbMF0NCiAgICAgICAgICAgIGlmICdcXCcgaW4gc291cmNlX3VybDoNCiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnXFwnKVstMV0uc3BsaXQoJy4nKVswXQ0KICAgICAgICAgICAgaWYgJyUnIGluIG5hbWVTdHI6DQogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHVybGxpYi51bnF1b3RlX3BsdXMobmFtZVN0cikNCiAgICAgICAgICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZChuYW1lU3RyLCdEaXNwbGF5ZWQgTmFtZSwgUmVuYW1lPycpDQogICAgICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkNCiAgICAgICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQ0KICAgICAgICAgICAgaWYgbGVuKG5ld1N0cikgPT0gMDoNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9DQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBuZXdTdHINCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsDQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gZmFuYXJ0DQoNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1GYWxzZToNCiAgICAgICAgICAgIHNvdXJjZV9saXN0ID0gW10NCiAgICAgICAgICAgIHNvdXJjZV9saXN0LmFwcGVuZChzb3VyY2VfbWVkaWEpDQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlX2xpc3QpKQ0KICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQ0KICAgICAgICAgICAgc291cmNlcy5hcHBlbmQoc291cmNlX21lZGlhKQ0KICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQ0KICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQ0KICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld191cmxfc291cmNlJywgIiIpDQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScsICIiKQ0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihNYXZlcmljayBUVixOZXcgc291cmNlIGFkZGVkLiw1MDAwLCIraWNvbisiKSIpDQogICAgICAgIGlmIG5vdCB1cmwgaXMgTm9uZToNCiAgICAgICAgICAgIGlmICd4Ym1jcGx1cy54Yi5mdW5waWMuZGUnIGluIHVybDoNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xNCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQ0KICAgICAgICAgICAgZWxpZiAnY29tbXVuaXR5LWxpbmtzJyBpbiB1cmw6DQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTAscmVwbGFjZSkiICVzeXMuYXJndlswXSkNCiAgICAgICAgZWxzZTogYWRkb24ub3BlblNldHRpbmdzKCkNCgkNCg0KZGVmIHJtU291cmNlKG5hbWUpOg0KICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQ0KICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKHNvdXJjZXMpKToNCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1tpbmRleF0sIGxpc3QpOg0KICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWzBdID09IG5hbWU6DQogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkNCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWyd0aXRsZSddID09IG5hbWU6DQogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkNCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQ0KDQoNCg0KZGVmIGdldF94bWxfZGF0YWJhc2UodXJsLCBicm93c2U9RmFsc2UpOg0KICAgICAgICBpZiB1cmwgaXMgTm9uZToNCiAgICAgICAgICAgIHVybCA9ICdodHRwOi8veGJtY3BsdXMueGIuZnVucGljLmRlL3d3dy1kYXRhL2ZpbGVzeXN0ZW0vJw0KICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQ0KICAgICAgICBmb3IgaSBpbiBzb3VwKCdhJyk6DQogICAgICAgICAgICBocmVmID0gaVsnaHJlZiddDQogICAgICAgICAgICBpZiBub3QgaHJlZi5zdGFydHN3aXRoKCc/Jyk6DQogICAgICAgICAgICAgICAgbmFtZSA9IGkuc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgbmFtZSBub3QgaW4gWydQYXJlbnQgRGlyZWN0b3J5JywgJ3JlY3ljbGVfYmluLyddOg0KICAgICAgICAgICAgICAgICAgICBpZiBocmVmLmVuZHN3aXRoKCcvJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBicm93c2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTUsaWNvbixmYW5hcnQsJycsJycsJycpDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE0LGljb24sZmFuYXJ0LCcnLCcnLCcnKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIGhyZWYuZW5kc3dpdGgoJy54bWwnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmFtZSBpbiBTT1VSQ0VTOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUrJyAoaW4gdXNlKScsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCg0KDQpkZWYgZ2V0Q29tbXVuaXR5U291cmNlcyhicm93c2U9RmFsc2UpOg0KICAgICAgICB1cmwgPSAnaHR0cDovL2NvbW11bml0eS1saW5rcy5nb29nbGVjb2RlLmNvbS9zdm4vdHJ1bmsvJw0KICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQ0KICAgICAgICBmaWxlcyA9IHNvdXAoJ3VsJylbMF0oJ2xpJylbMTpdDQogICAgICAgIGZvciBpIGluIGZpbGVzOg0KICAgICAgICAgICAgbmFtZSA9IGkoJ2EnKVswXVsnaHJlZiddDQogICAgICAgICAgICBpZiBicm93c2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KDQoNCmRlZiBnZXRTb3VwKHVybCxkYXRhPU5vbmUpOg0KICAgICAgICBwcmludCAnZ2V0c291cCcsdXJsLGRhdGENCiAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoJ2h0dHA6Ly8nKSBvciB1cmwuc3RhcnRzd2l0aCgnaHR0cHM6Ly8nKToNCiAgICAgICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpDQogICAgICAgICAgICBpZiByZS5zZWFyY2goIiNFWFRNM1UiLGRhdGEpIG9yICdtM3UnIGluIHVybDogDQogICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJyxkYXRhDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgICAgICANCiAgICAgICAgZWxpZiBkYXRhID09IE5vbmU6DQogICAgICAgICAgICBpZiB4Ym1jdmZzLmV4aXN0cyh1cmwpOg0KICAgICAgICAgICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCJzbWI6Ly8iKSBvciB1cmwuc3RhcnRzd2l0aCgibmZzOi8vIik6DQogICAgICAgICAgICAgICAgICAgIGNvcHkgPSB4Ym1jdmZzLmNvcHkodXJsLCBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgY29weToNCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpLCAiciIpLnJlYWQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3Zmcy5kZWxldGUob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coImZhaWxlZCB0byBjb3B5IGZyb20gc21iOiIpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4odXJsLCAncicpLnJlYWQoKQ0KICAgICAgICAgICAgICAgICAgICBpZiByZS5tYXRjaCgiI0VYVE0zVSIsZGF0YSlvciAnbTN1JyBpbiB1cmw6IA0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJyxkYXRhDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlNvdXAgRGF0YSBub3QgZm91bmQhIikNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgcmV0dXJuIEJlYXV0aWZ1bFNPQVAoZGF0YSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFN0b25lU291cC5YTUxfRU5USVRJRVMpDQoNCg0KZGVmIGdldERhdGEodXJsLGZhbmFydCk6DQogICAgcHJpbnQgJ3VybC1nZXREYXRhJyx1cmwNCiAgICBTZXRWaWV3TGF5b3V0ID0gIkxpc3QiDQogICAgIA0KICAgIHNvdXAgPSBnZXRTb3VwKHVybCkNCiAgICAjcHJpbnQgdHlwZShzb3VwKQ0KICAgIGlmIGlzaW5zdGFuY2Uoc291cCxCZWF1dGlmdWxTT0FQKToNCiAgICAgICAgaWYgbGVuKHNvdXAoJ2xheW91dHlwZScpKSA+IDA6DQogICAgICAgICAgICBTZXRWaWV3TGF5b3V0ID0gIlRodW1ibmFpbCIJCSAgICANCg0KICAgICAgICBpZiBsZW4oc291cCgnY2hhbm5lbHMnKSkgPiAwOg0KICAgICAgICAgICAgY2hhbm5lbHMgPSBzb3VwKCdjaGFubmVsJykNCiAgICAgICAgICAgIGZvciBjaGFubmVsIGluIGNoYW5uZWxzOg0KIyAgICAgICAgICAgICAgICBwcmludCBjaGFubmVsDQoNCiAgICAgICAgICAgICAgICBsaW5rZWRVcmw9JycNCiAgICAgICAgICAgICAgICBsY291bnQ9MA0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgbGlua2VkVXJsID0gIGNoYW5uZWwoJ2V4dGVybmFsbGluaycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBsY291bnQ9bGVuKGNoYW5uZWwoJ2V4dGVybmFsbGluaycpKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgICAgICNwcmludCAnbGlua2VkVXJsJyxsaW5rZWRVcmwsbGNvdW50DQogICAgICAgICAgICAgICAgaWYgbGNvdW50PjE6IGxpbmtlZFVybD0nJw0KDQogICAgICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgbGlua2VkVXJsPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwyLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgPT0gJ1tDT0xPUiByZWRdTGl2ZSBTcG9ydFsvQ09MT1JdJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksbGlua2VkVXJsLmVuY29kZSgndXRmLTgnKSwzMSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCgkJCQkJCSAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksbGlua2VkVXJsLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSBmcm9tIGdldERhdGEoKTogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhZGRvbl9sb2coJ05vIENoYW5uZWxzOiBnZXRJdGVtcycpDQogICAgICAgICAgICBnZXRJdGVtcyhzb3VwKCdpdGVtJyksZmFuYXJ0KQ0KICAgIGVsc2U6DQogICAgICAgIHBhcnNlX20zdShzb3VwKQ0KDQogICAgaWYgU2V0Vmlld0xheW91dCA9PSAiVGh1bWJuYWlsIjoNCiAgICAgICBTZXRWaWV3VGh1bWJuYWlsKCkNCgkgICANCmRlZiBXaXpIRE1lbnUodXJsLGljb25pbWFnZSxmYW5hcnQpOg0KCWFkZERpcignTWF2ZXJpY2sgVFYgUGxheWxpc3RlZCcsdXJsLDEsaWNvbmltYWdlLGZhbmFydCwnJywnJywnJyxOb25lLCdzb3VyY2UnKQ0KCWh0bWwgPSByZXF1ZXN0cy5nZXQoJ2h0dHA6Ly93aXpoZHNwb3J0cy5pcy8nKS5jb250ZW50DQoJYmxvY2sgPSByZS5jb21waWxlKCc8dWwgY2xhc3M9InNwb3J0c19tZW51Ij4oLis/KTwvdWw+JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCglmb3IgaXRlbSBpbiBibG9jazoNCgkJbWF0Y2ggPSByZS5jb21waWxlKCc8YSBocmVmPSIoLis/KSIuKz9zcmM9IiguKz8pIi4rPz4gKC4rPyk8L2xpPicpLmZpbmRhbGwoc3RyKGl0ZW0pKQ0KCQlmb3IgdXJsMixpY29uaW1hZ2UsbmFtZSBpbiBtYXRjaDoNCgkJCW5hbWUgPSBuYW1lLnRpdGxlKCkNCgkJCWlmIG5hbWUgPT0gJ05mbCc6aW1hZ2UgPSBOZmwNCgkJCWVsaWYgbmFtZSA9PSAnRm9vdGJhbGwnOmltYWdlID0gRm9vdGJhbGwNCgkJCWVsaWYgbmFtZSA9PSAnQ3JpY2tldCc6aW1hZ2UgPSBDcmlja2V0DQoJCQllbGlmIG5hbWUgPT0gJ1Rlbm5pcyc6aW1hZ2UgPSBUZW5uaXMNCgkJCWVsaWYgbmFtZSA9PSAnQm94aW5nJzppbWFnZSA9IEJveGluZw0KCQkJZWxpZiBuYW1lID09ICdHb2xmJzppbWFnZSA9IEdvbGYNCgkJCWVsaWYgbmFtZSA9PSAnTW90b3Nwb3J0cyc6aW1hZ2UgPSBNb3RvcnNwb3J0cw0KCQkJZWxpZiBuYW1lID09ICdSdWdieSc6aW1hZ2UgPSBSdWdieQ0KCQkJZWxpZiBuYW1lID09ICdIb2NrZXknOmltYWdlID0gSG9ja2V5DQoJCQllbGlmIG5hbWUgPT0gJ05iYSc6aW1hZ2UgPSBOYmENCgkJCWVsaWYgbmFtZSA9PSAnRGFydHMnOmltYWdlID0gRGFydHMNCgkJCWVsaWYgbmFtZSA9PSAnV3dlJzppbWFnZSA9IFd3ZQ0KCQkJZWxpZiBuYW1lID09ICdIb3JzZSBSYWNpbmcnOmltYWdlID0gSG9yc2VfUmFjaW5nDQoJCQllbGlmIG5hbWUgPT0gJ1VmYyc6aW1hZ2UgPSBVZmMNCgkJCWVsaWYgbmFtZSA9PSAnQmFzZWJhbGwnOmltYWdlID0gQmFzZWJhbGwNCgkJCWlmIG5hbWUgPT0gJ1R2IFNob3dzJzpwYXNzDQoJCQllbGlmIG5hbWUgPT0gJ090aGVycyc6cGFzcw0KCQkJZWxpZiBuYW1lID09ICdQMlAgT25saW5lJzpwYXNzDQoJCQllbHNlOg0KCQkJCWlmIGltYWdlID09ICcnOg0KCQkJCQlpbWFnZSA9IGljb25pbWFnZQ0KCQkJCWFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmwyLmVuY29kZSgndXRmLTgnKSwzMixpbWFnZSxmYW5hcnQsJycsJycsJycsTm9uZSwnc291cmNlJykNCgkJCQkNCmRlZiBXaXpfR2V0X3VybCh1cmwpOg0KCUxpc3QgPSBbXQ0KDQoJZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUNCgl0b2RheXNfZGF5ID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkJykNCgl0b2RheXNfbW9udGggPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJW0nKQ0KCXRvZGF5c195ZWFyID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZJykNCgl0b2RheXNfaG91ciA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSCcpDQoJdG9kYXlzX21pbnV0ZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclTScpDQoJZmluX2RhdGUgPSB0b2RheXNfZGF5KyctJyt0b2RheXNfbW9udGgrJy0nK3RvZGF5c195ZWFyDQoJaHRtbCA9IHJlcXVlc3RzLmdldCh1cmwpLmNvbnRlbnQNCglibG9jayA9IHJlLmNvbXBpbGUoJzxoMz4uKz9HYW1lcyBPbiA6ICguKz8pPC9oMz4oLis/KTxsaSBjbGFzcz1cJ3Nwb3J0c19yZWRfYmFyXCc+JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCglmb3IgZGF0ZSxyZXN0IGluIGJsb2NrOg0KCQlpZiBkYXRlID09IGZpbl9kYXRlOg0KCQkJbWF0Y2ggPSByZS5jb21waWxlKCc8ZGl2IGNsYXNzPVwnY29sLW1kLTJcJz4uKz88L3NwYW4+KC4rPyk8L2Rpdj4uKz88ZGl2IGNsYXNzPVwnY29sLW1kLTZcJz4oLis/KTwvZGl2Pi4rP2RpdiBjbGFzcz0iY2FyZC1ibG9jayBkcm9wX2JveCI+KC4rPyk8ZGl2IGNsYXNzPSJjYXJkIj4nLHJlLkRPVEFMTCkuZmluZGFsbChzdHIocmVzdCkpDQoJCQlmb3IgdGltZSx0ZWFtcyxsaW5rX2Jsb2NrIGluIG1hdGNoOg0KCQkJCXRvdGFsID0gbGVuKG1hdGNoKQ0KCQkJCXRlYW1zID0gdGVhbXMucmVwbGFjZSgnICAnLCcnKS5yZXBsYWNlKCcJJywnJykNCgkJCQlsaW5rX2Jsb2NrID0gbGlua19ibG9jay5yZXBsYWNlKCcgICcsJycpDQoJCQkJdGltZV9zcGxpdCA9IHJlLmZpbmRhbGwoJyguKz8pOiguKz8pLSguKz8pOiguKz8pPicsc3RyKHRpbWUrJz4nKSkNCgkJCQlmb3Igc3RhcnRfaG91cixzdGFydF9taW4sZmluX2hvdXIsZmluX21pbiBpbiB0aW1lX3NwbGl0Og0KCQkJCQlzdGFydF9ubyA9IGludChzdGFydF9ob3VyKSoyNCtpbnQoc3RhcnRfbWluKQ0KCQkJCQlmaW5fbm8gPSBpbnQoZmluX2hvdXIpKjI0K2ludChmaW5fbWluKQ0KCQkJCQl0aW1lX25vdyA9IGludCh0b2RheXNfaG91cikqMjQraW50KHRvZGF5c19taW51dGUpDQoJCQkJCWlmIGZpbl9ubz50aW1lX25vdz5zdGFydF9ubzoNCgkJCQkJCW5hbWUgPSAnW0NPTE9SZ3JlZW5dJysgdGVhbXMrJ1svQ09MT1JdJw0KCQkJCQllbHNlOg0KCQkJCQkJbmFtZSA9IHRlYW1zDQoJCQkJbGlua19nZXQgPSByZS5jb21waWxlKCI8YSBocmVmPScoLis/KSc+Lis/PiguKz8pPC9kaXY+PC9hPiIpLmZpbmRhbGwoc3RyKGxpbmtfYmxvY2spKQ0KCQkJCWZvciBsaW5rLGNobmwgaW4gbGlua19nZXQ6DQoJCQkJCWxpbmsgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JytsaW5rDQoJCQkJCWlmIGxlbihsaW5rX2dldCk+MToNCgkJCQkJCUxpc3QuYXBwZW5kKChsaW5rLGNobmwpKQ0KCQkJCQllbHNlOg0KCQkJCQkJYWRkTGluayhsaW5rLHRpbWUucmVwbGFjZSgnICcsJycpKyctJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksaWNvbixGQU5BUlQsJycsJycsJycsVHJ1ZSxOb25lLHJlZ2V4cyx0b3RhbCkJCQkJCQkNCgkJCQlpZiBsZW4oTGlzdCk+MToNCgkJCQkJdnVybCA9IHN0cihMaXN0KS5yZXBsYWNlKCdbJywnc3VibGluaycpLnJlcGxhY2UoJ10nLCcjJykucmVwbGFjZSgnc3VibGluayhcJycsJ3N1Ymxpbms6JykucmVwbGFjZSgncGx1Z2luOicsJ0xJU1RTT1VSQ0U6cGx1Z2luOicpLnJlcGxhY2UoIicsICciLCc6OkxJU1ROQU1FOicpLnJlcGxhY2UoIicpLCAoJyIsJzo6I3N1YmxpbmsnKS5yZXBsYWNlKCInKSIsJycpLnJlcGxhY2UoJ3N1YmxpbmtMSVNUU09VUkNFJywnc3VibGluazpMSVNUU09VUkNFJykNCgkJCQkJeGJtYy5sb2codnVybCkNCgkJCQkJYWRkRGlyKHRpbWUucmVwbGFjZSgnICcsJycpKyctJytuYW1lLHZ1cmwsMzAsaWNvbixGQU5BUlQsJycsJycsJycsJycpDQoJCQkJCWRlbCBMaXN0WzpdDQoJCQ0KDQoNCgkNCg0KIyBib3Jyb3cgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZW5lbjkyL1AyUC1TdHJlYW1zLVhCTUMvYmxvYi9tYXN0ZXIvcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zL3Jlc291cmNlcy9jb3JlL2xpdmVzdHJlYW1zLnB5DQojIFRoaXMgd2lsbCBub3QgZ28gdGhyb3VnaCB0aGUgZ2V0SXRlbXMgZnVuY3Rpb25zICggbWVhbnMgeW91IG11c3QgaGF2ZSByZWFkeSB0byBwbGF5IHVybCwgbm8gcmVnZXgpDQpkZWYgcGFyc2VfbTN1KGRhdGEpOg0KICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpDQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cbl0rKScpLmZpbmRhbGwoY29udGVudCkNCiAgICB0b3RhbCA9IGxlbihtYXRjaCkNCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbA0KICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoNCiAgICAgICAgaWYgJ3R2Zy1sb2dvJyBpbiBvdGhlcjoNCiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgdGh1bWJuYWlsOg0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbC5zdGFydHN3aXRoKCdodHRwJyk6DQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGVsaWYgbm90IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpID09ICIiOg0KICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpDQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsDQoNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICNlbHNlOg0KICAgICAgICAgICAgDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB0aHVtYm5haWwgPSAnJw0KICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6DQogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgbW9kZV90eXBlID09ICd5dC1kbCc6DQogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCINCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6DQogICAgICAgICAgICAgICAgdXJsID0gc3RyZWFtX3VybC5zcGxpdCgnJnJlZ2V4cz0nKQ0KICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQ0KICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIGFkZExpbmsoc3RyZWFtX3VybCwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsKQ0KCQkNCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTApIikNCgkNCmRlZiBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToNCiAgICAgICAgc291cCA9IGdldFNvdXAodXJsKQ0KICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ2NoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQ0KICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnaXRlbScpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWxfbGlzdCgnZmFuYXJ0JylbMF0uc3RyaW5nDQogICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbF9saXN0KCdzdWJjaGFubmVsJyk6DQogICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGVzYyA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBkYXRlID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDMsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGNyZWRpdHMsZGF0ZSkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSAtICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQ0KICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5BcnQpDQoNCg0KZGVmIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOg0KICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpDQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnc3ViY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pDQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdzdWJpdGVtJykNCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KQ0KDQojaGFrYW1hYw0KZGVmIEdldFN1YmxpbmtzKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQpOg0KICAgIHhibWMubG9nKCdJIEdPVCBIRVJFIyMjIyMjIyMjIyMjIyMjJykNCiAgICBMaXN0PVtdOyBMaXN0VT1bXTsgYz0wDQogICAgYWxsX3ZpZGVvcyA9IHJlZ2V4X2dldF9hbGwodXJsLCAnc3VibGluazonLCAnIycpDQogICAgZm9yIGEgaW4gYWxsX3ZpZGVvczoNCiAgICAgICAgaWYgJ0xJU1RTT1VSQ0U6JyBpbiBhOg0KICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJ0xJU1RTT1VSQ0U6JywgJzo6JykNCiAgICAgICAgICAgIGxpbmVuYW1lID0gcmVnZXhfZnJvbV90byhhLCAnTElTVE5BTUU6JywgJzo6JykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHZ1cmwgPSBhLnJlcGxhY2UoJ3N1Ymxpbms6JywnJykucmVwbGFjZSgnIycsJycpDQogICAgICAgICAgICBsaW5lbmFtZSA9IG5hbWUNCiAgICAgICAgaWYgbGVuKHZ1cmwpID4gMTA6DQogICAgICAgICAgICBjPWMrMTsgTGlzdC5hcHBlbmQobGluZW5hbWUpOyBMaXN0VS5hcHBlbmQodnVybCkNCiANCiAgICBpZiBjPT0xOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjcHJpbnQgJ3BsYXkgMSAgIE5hbWU6JyArIG5hbWUgKyAnICAgdXJsOicgKyBMaXN0VVswXSArICcgICAgICcgKyBzdHIoYykNCiAgICAgICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKTsgbGl6LnNldEluZm8oIHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUgfSApDQogICAgICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPUxpc3RVWzBdLGxpc3RpdGVtPWxpeikNCiAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmxzb2x2ZXIoTGlzdFVbMF0pLCBsaXopDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICBlbHNlOg0KICAgICAgICAgZGlhbG9nPXhibWNndWkuRGlhbG9nKCkNCiAgICAgICAgIHJObz1kaWFsb2cuc2VsZWN0KCdNYXZlcmljayBUViBTZWxlY3QgQSBTb3VyY2UnLCBMaXN0KQ0KICAgICAgICAgaWYgck5vPj0wOg0KICAgICAgICAgICAgIHJOYW1lPW5hbWUNCiAgICAgICAgICAgICByVVJMPXN0cihMaXN0VVtyTm9dKQ0KICAgICAgICAgICAgICNwcmludCAnU3VibGlua3MgICBOYW1lOicgKyBuYW1lICsgJyAgIHVybDonICsgclVSTA0KICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihyVVJMKSwgeGJtY2d1aS5MaXN0SXRlbShyTmFtZSkpDQogICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkoclVSTCwgeGJtY2d1aS5MaXN0SXRlbShyTmFtZSkpDQoNCgkJCQkNCmRlZiBTZWFyY2hDaGFubmVscygpOg0KI2hha2FtYWMgY29kZQ0KICAgIEtleWJvYXJkTWVzc2FnZSA9ICdOYW1lIG9mIGNoYW5uZWwgc2hvdyBvciBtb3ZpZScNCiAgICBTZWFyY2hrZXkgPSAnJw0KICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZChTZWFyY2hrZXksIEtleWJvYXJkTWVzc2FnZSkNCiAgICBrZXlib2FyZC5kb01vZGFsKCkNCiAgICBpZiBrZXlib2FyZC5pc0NvbmZpcm1lZCgpOg0KICAgICAgIFNlYXJjaGtleSA9IGtleWJvYXJkLmdldFRleHQoKS5yZXBsYWNlKCdcbicsJycpLnN0cmlwKCkNCiAgICAgICBpZiBsZW4oU2VhcmNoa2V5KSA9PSAwOiANCiAgICAgICAgICB4Ym1jZ3VpLkRpYWxvZygpLm9rKCdSb2Jpbkhvb2QnLCAnTm90aGluZyBFbnRlcmVkJykNCiAgICAgICAgICByZXR1cm4JICAgDQogICAgDQogICAgU2VhcmNoa2V5ID0gU2VhcmNoa2V5Lmxvd2VyKCkNCiAgICBMaXN0PVtdDQogICAgTGlzdC5hcHBlbmQoX0VkaXQuTWFpbkJhc2UpDQogICAgUGFzc2VkVXJscyA9IDANCiAgICBGb3VuZENoYW5uZWwgPSAxIA0KICAgIFJlYWRDaGFubmVsID0gMA0KICAgIEZvdW5kTWF0Y2ggPSAwDQogICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkNCiAgICBwcm9ncmVzcy5jcmVhdGUoJ01hdmVyaWNrIFRWIFNlYXJjaGluZyBQbGVhc2Ugd2FpdCcsJyAnKQ0KCQ0KICAgIHdoaWxlIEZvdW5kQ2hhbm5lbCA8PiBSZWFkQ2hhbm5lbDoNCiAgICAgICAgQmFzZVNlYXJjaCA9IExpc3RbUmVhZENoYW5uZWxdLnN0cmlwKCkNCiAgICAgICAgcHJpbnQgJ3JlYWQgdGhpcyBvbmUgZnJvbSBmaWxlIGxpc3QgKCcgKyBzdHIoUmVhZENoYW5uZWwpICsgJyknICANCiAgICAgICAgUmVhZENoYW5uZWwgPSBSZWFkQ2hhbm5lbCArIDENCg0KICAgICAgICBQYWdlU291cmNlID0gJycNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgUGFnZVNvdXJjZSA9IG5ldC5odHRwX0dFVChCYXNlU2VhcmNoKS5jb250ZW50DQogICAgICAgICAgICBQYWdlU291cmNlID0gUGFnZVNvdXJjZS5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpLmRlY29kZSgnYXNjaWknKQ0KICAgICAgICAgICAgI3RpbWUuc2xlZXAoMSkNCiAgICAgICAgZXhjZXB0OiANCiAgICAgICAgICAgIHBhc3MNCgkJDQogICAgICAgIGlmIGxlbihQYWdlU291cmNlKSA8IDEwOg0KICAgICAgICAgICAgUGFnZVNvdXJjZSA9ICcnDQogICAgICAgICAgICBQYXNzZWRVcmxzID0gUGFzc2VkVXJscyArIDENCiAgICAgICAgICAgIHByaW50ICcqKiogUEFTU0VEICoqKionICsgQmFzZVNlYXJjaCArICcgICoqKioqKioqKioqKiogVG90YWwgUGFzc2VkIFVybHM6ICcgKyBzdHIoUGFzc2VkVXJscykNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoLjUpDQogDQogICAgICAgIHBlcmNlbnQgPSBpbnQoICggUmVhZENoYW5uZWwgLyAzMDApICogMTAwKSANCiAgICAgICAgbWVzc2FnZSA9ICcgICAgIFBhZ2VzIFJlYWQ6ICcrc3RyKFJlYWRDaGFubmVsKSsnICAgICAgICBNYXRjaGVzIEZvdW5kOiAnICsgc3RyKEZvdW5kTWF0Y2gpDQogICAgICAgIHByb2dyZXNzLnVwZGF0ZShwZXJjZW50LCIiLCBtZXNzYWdlLCAiIiApDQoNCiAgICAgICAgaWYgcHJvZ3Jlc3MuaXNjYW5jZWxlZCgpOg0KICAgICAgICAgICByZXR1cm4NCiAJCQ0KICAgICAgICBpZiBsZW4oUGFnZVNvdXJjZSkgPiAxMDoNCiAgICAgICAgICAgIGFsbF9saW5rcyA9IHJlZ2V4X2dldF9hbGwoUGFnZVNvdXJjZSwgJzxjaGFubmVsPicsICc8L2NoYW5uZWw+JykNCiAgICAgICAgICAgIGZvciBhIGluIGFsbF9saW5rczoNCiAgICAgICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnPGV4dGVybmFsbGluaz4nLCAnPC9leHRlcm5hbGxpbms+JykNCiAgICAgICAgICAgICAgICAjbmFtZSA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxuYW1lPicsICc8L25hbWU+JykNCiAgICAgICAgICAgICAgICAjcHJpbnQgbmFtZSArICcgICAgJyArIHZ1cmwNCiAgICAgICAgICAgICAgICBpZiBsZW4odnVybCkgPiA1Og0KICAgICAgICAgICAgICAgICAgIEZvdW5kQ2hhbm5lbCA9IEZvdW5kQ2hhbm5lbCArIDENCiAgICAgICAgICAgICAgICAgICBMaXN0LmFwcGVuZCh2dXJsKQ0KICAgICAgICAgICAgICAgICAgICNwcmludCAnRm91bmQgQ2hhbm5lbDogJysgc3RyKEZvdW5kQ2hhbm5lbCkgKycgOiAnKyB2dXJsIA0KDQogICAgICAgICAgICBhbGxfaXRlbXMgPSByZWdleF9nZXRfYWxsKFBhZ2VTb3VyY2UsICc8aXRlbT4nLCAnPC9pdGVtPicpDQogICAgICAgICAgICBmb3IgYSBpbiBhbGxfaXRlbXM6DQogICAgICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxsaW5rPicsICc8L2xpbms+JykNCiAgICAgICAgICAgICAgICBuYW1lID0gcmVnZXhfZnJvbV90byhhLCAnPHRpdGxlPicsICc8L3RpdGxlPicpDQogICAgICAgICAgICAgICAgVGVzdE5hbWUgPSAnICAnICsgbmFtZS5sb3dlcigpICsgJyAgJw0KICAgICAgICAgICAgICAgICNwcmludCAnVGVzdGluZzonICsgVGVzdE5hbWUgKyAnICAnICsgU2VhcmNoa2V5DQogICAgICAgICAgICAgICAgaWYgbGVuKHZ1cmwpID4gNSBhbmQgVGVzdE5hbWUuZmluZChTZWFyY2hrZXkpID4gMDoNCiAgICAgICAgICAgICAgICAgICAgRm91bmRNYXRjaCA9IEZvdW5kTWF0Y2ggKyAxDQogICAgICAgICAgICAgICAgICAgIGZhbmFydCA9ICcnDQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzx0aHVtYm5haWw+JywgJzwvdGh1bWJuYWlsPicpDQogICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxmYW5hcnQ+JywgJzwvZmFuYXJ0PicpDQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihmYW5hcnQpIDwgNToNCiAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gaWNvbg0KICAgICAgICAgICAgICAgICAgICBpZiB2dXJsLmZpbmQoJ3N1YmxpbmsnKSA+IDA6DQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx2dXJsLDMwLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6IA0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayhzdHIodnVybCksbmFtZSx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLFRydWUsTm9uZSwnJywxKQ0KCQkJCQkJDQogICAgDQogICAgcHJvZ3Jlc3MuY2xvc2UoKQ0KICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MCkiKQ0KCQ0KZGVmIFNlYXJjaF9tM3UoZGF0YSxTZWFyY2hrZXkpOg0KICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpDQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cbl0rKScpLmZpbmRhbGwoY29udGVudCkNCiAgICB0b3RhbCA9IGxlbihtYXRjaCkNCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbA0KICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoNCiAgICAgICAgaWYgJ3R2Zy1sb2dvJyBpbiBvdGhlcjoNCiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgdGh1bWJuYWlsOg0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbC5zdGFydHN3aXRoKCdodHRwJyk6DQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGVsaWYgbm90IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpID09ICIiOg0KICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpDQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsDQoNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICNlbHNlOg0KICAgICAgICAgICAgDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB0aHVtYm5haWwgPSAnJw0KICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6DQogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgbW9kZV90eXBlID09ICd5dC1kbCc6DQogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCINCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6DQogICAgICAgICAgICAgICAgdXJsID0gc3RyZWFtX3VybC5zcGxpdCgnJnJlZ2V4cz0nKQ0KICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQ0KICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIGFkZExpbmsoc3RyZWFtX3VybCwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsKQ0KDQpkZWYgRmluZEZpcnN0UGF0dGVybih0ZXh0LHBhdHRlcm4pOg0KICAgIHJlc3VsdCA9ICIiDQogICAgdHJ5OiAgICANCiAgICAgICAgbWF0Y2hlcyA9IHJlLmZpbmRhbGwocGF0dGVybix0ZXh0LCBmbGFncz1yZS5ET1RBTEwpDQogICAgICAgIHJlc3VsdCA9IG1hdGNoZXNbMF0NCiAgICBleGNlcHQ6DQogICAgICAgIHJlc3VsdCA9ICIiDQoNCiAgICByZXR1cm4gcmVzdWx0DQoJDQpkZWYgcmVnZXhfZ2V0X2FsbCh0ZXh0LCBzdGFydF93aXRoLCBlbmRfd2l0aCk6DQogICAgciA9IHJlLmZpbmRhbGwoIig/aSkoIiArIHN0YXJ0X3dpdGggKyAiW1xTXHNdKz8iICsgZW5kX3dpdGggKyAiKSIsIHRleHQpDQogICAgcmV0dXJuIHIJCQkJDQoNCmRlZiByZWdleF9mcm9tX3RvKHRleHQsIGZyb21fc3RyaW5nLCB0b19zdHJpbmcsIGV4Y2x1ZGluZz1UcnVlKToNCiAgICBpZiBleGNsdWRpbmc6DQoJICAgdHJ5OiByID0gcmUuc2VhcmNoKCIoP2kpIiArIGZyb21fc3RyaW5nICsgIihbXFNcc10rPykiICsgdG9fc3RyaW5nLCB0ZXh0KS5ncm91cCgxKQ0KCSAgIGV4Y2VwdDogciA9ICcnDQogICAgZWxzZToNCiAgICAgICB0cnk6IHIgPSByZS5zZWFyY2goIig/aSkoIiArIGZyb21fc3RyaW5nICsgIltcU1xzXSs/IiArIHRvX3N0cmluZyArICIpIiwgdGV4dCkuZ3JvdXAoMSkNCiAgICAgICBleGNlcHQ6IHIgPSAnJw0KICAgIHJldHVybiByDQoNCmRlZiBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpOg0KICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykNCiAgICAgICAgcHJpbnQgJ1NUQVJUIEdFVCBJVEVNUyAqKioqKicNCiAgICAgICAgYWRkb25fbG9nKCdUb3RhbCBJdGVtczogJXMnICV0b3RhbCkNCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6DQogICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQ0KICAgICAgICAgICAgaXNKc29ucnBjID0gRmFsc2UNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBuYW1lID0gaXRlbSgndGl0bGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBuYW1lIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAndW5rbm93bj8nDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdOYW1lIEVycm9yJykNCiAgICAgICAgICAgICAgICBuYW1lID0gJycNCg0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgaXRlbSgnZXBnJyk6DQogICAgICAgICAgICAgICAgICAgIGlmIGl0ZW0uZXBnX3VybDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnR2V0IEVQRyBSZWdleCcpDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfdXJsID0gaXRlbS5lcGdfdXJsLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3JlZ2V4ID0gaXRlbS5lcGdfcmVnZXguc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfbmFtZSA9IGdldF9lcGcoZXBnX3VybCwgZXBnX3JlZ2V4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXBnX25hbWU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnIC0gJyArIGVwZ19uYW1lDQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXRlbSgnZXBnJylbMF0uc3RyaW5nID4gMToNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gZ2V0ZXBnKGl0ZW0oJ2VwZycpWzBdLnN0cmluZykNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFUEcgRXJyb3InKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHVybCA9IFtdDQogICAgICAgICAgICAgICAgaWYgbGVuKGl0ZW0oJ2xpbmsnKSkgPjA6DQojICAgICAgICAgICAgICAgICAgICBwcmludCAnaXRlbSBsaW5rJywgaXRlbSgnbGluaycpDQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2xpbmsnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaS5zdHJpbmcpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3Nwb3J0c2RldmlsJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdzcG9ydHNkZXZpbCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JyAraS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVyID0gaXRlbSgncmVmZXJlcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZmVyZXI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmVmZXJlciBmb3VuZCcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSBzcG9ydHNkZXZpbCArICclMjZyZWZlcmVyPScgK3JlZmVyZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNwb3J0c2RldmlsKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3AycCcpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgncDJwJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnc29wOi8vJyBpbiBpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3AgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz91cmw9JytpLnN0cmluZyArJyZhbXA7bW9kZT0yJmFtcDsnICsgJ25hbWU9JytuYW1lIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNvcCkgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJwPSdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP3VybD0nK2kuc3RyaW5nICsnJmFtcDttb2RlPTEmYW1wOycgKyAnbmFtZT0nK25hbWUgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQocDJwKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3ZhdWdobicpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndmF1Z2huJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXVnaG4gPSAncGx1Z2luOi8vcGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2Lz9tb2RlPVBsYXlMaXZlU3RyZWFtJmFtcDtjaGFubmVsPScraS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHZhdWdobikNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbGl2ZScpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaWxpdmUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAnaHR0cCcgaW4gaS5zdHJpbmc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlsaXZlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby50YmguaWxpdmUvP3VybD1odHRwOi8vd3d3LnN0cmVhbWxpdmUudG8vdmlldy8nK2kuc3RyaW5nKycmYW1wO2xpbms9OTkmYW1wO21vZGU9aUxpdmVQbGF5Jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlsaXZlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby50YmguaWxpdmUvP3VybD0nK2kuc3RyaW5nKycmYW1wO2xpbms9OTkmYW1wO21vZGU9aUxpdmVQbGF5Jw0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3l0LWRsJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd5dC1kbCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRkbCA9IGkuc3RyaW5nICsgJyZtb2RlPTE4Jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoeXRkbCkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd1dHViZScpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndXR1YmUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihpLnN0cmluZykgPT0gMTE6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScrIGkuc3RyaW5nIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnUEwnKSBhbmQgbm90ICcmb3JkZXI9JyBpbiBpLnN0cmluZyA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvPyZvcmRlcj1kZWZhdWx0JnBsYXlsaXN0X2lkPScgKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3BsYXlsaXN0X2lkPScgKyBpLnN0cmluZyANCiAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh1dHViZSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbWRiJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbWRiJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdnZW5lc2lzb3JwdWxzYXInKSA9PSAnMCc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1wbGF5JmltZGI9JytpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS90dCcraS5zdHJpbmcrJy9wbGF5Jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaW1kYikgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZjRtJykpID4wOg0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZjRtJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcuZjRtJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLm0zdTgnIGluIGkuc3RyaW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPUhMUycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPVNJTVBMRScNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZjRtKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2Z0dicpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZnR2Jyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdHYgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLkYuVC5WLz9uYW1lPScrdXJsbGliLnF1b3RlKG5hbWUpICsnJnVybD0nICtpLnN0cmluZyArJyZtb2RlPTEyNSZjaF9mYW5hcnQ9bmEnDQogICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGZ0dikgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA8IDE6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFcnJvciA8bGluaz4gZWxlbWVudCwgUGFzc2luZzonK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlID0gaXRlbSgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6DQogICAgICAgICAgICAgICAgZXh0X3VybD1baXNYTUxTb3VyY2VdDQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9VHJ1ZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlzSnNvbnJwYyA9IGl0ZW0oJ2pzb25ycGMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgaWYgaXNKc29ucnBjOg0KICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzSnNvbnJwY10NCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9VHJ1ZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9RmFsc2UgICAgICAgICAgICANCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBpdGVtKCd0aHVtYm5haWwnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIG5vdCBpdGVtKCdmYW5hcnQnKToNCiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBpdGVtKCdmYW5hcnQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBkZXNjID0gaXRlbSgnaW5mbycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBkZXNjID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGdlbnJlID0gaXRlbSgnZ2VucmUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGdlbnJlID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGRhdGUgPSBpdGVtKCdkYXRlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGRhdGUgPSAnJw0KDQogICAgICAgICAgICByZWdleHMgPSBOb25lDQogICAgICAgICAgICBpZiBpdGVtKCdyZWdleCcpOg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgcmVnX2l0ZW0gPSBpdGVtKCdyZWdleCcpDQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KHJlZ19pdGVtKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcyAgICAgICAgICAgIA0KICAgICAgICAgICANCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA+IDE6DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBhbHQgPSAwDQogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0ID0gW10NCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gdXJsOg0KICAgICAgICAgICAgICAgICAgICAJaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnOg0KCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoNCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZyZWdleHM9JytyZWdleHMpDQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYW55KHggaW4gaSBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICBpLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZtb2RlPTE5JykgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKQ0KICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gdXJsOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQgKz0gMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnQURETElOSyAxJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKGksJyVzKSAlcycgJShhbHQsIG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSksdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxwbGF5bGlzdCxyZWdleHMsdG90YWwpICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluaygnJywgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOg0KICAgICAgICAgICAgICAgICAgICAJYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGV4dF91cmxbMF0uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpc0pzb25ycGM6DQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXSw1Myx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIHVybFswXS5maW5kKCdzdWJsaW5rJykgPiAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXSwzMCx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI2FkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmxbMF0sMzAsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsJ3N1YmxpbmsnKQkJCQkNCiAgICAgICAgICAgICAgICAgICAgZWxzZTogDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSxuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxOb25lLHJlZ2V4cyx0b3RhbCkNCg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N1Y2Nlc3MnDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBpdGVtIC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQogICAgICAgIHByaW50ICdGSU5JU0ggR0VUIElURU1TICoqKioqJyAgICAgIA0KDQpkZWYgcGFyc2VfcmVnZXgocmVnX2l0ZW0pOg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0ge30NCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmVnX2l0ZW06DQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ10gPSB7fQ0KICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXT0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwYWdlJ10gPSBpKCdwYWdlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWZlciddID0gaSgncmVmZXJlcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29ubmVjdGlvbiddID0gaSgnY29ubmVjdGlvbicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIGNvbm5lY3Rpb24gLS0iKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydub3RwbGF5YWJsZSddID0gaSgnbm90cGxheWFibGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBub3RwbGF5YWJsZSAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydub3JlZGlyZWN0J10gPSBpKCdub3JlZGlyZWN0JylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbm9yZWRpcmVjdCAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydvcmlnaW4nXSA9IGkoJ29yaWdpbicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG9yaWdpbiAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpbmNsdWRlaGVhZGVycyddID0gaSgnaW5jbHVkZWhlYWRlcnMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBpbmNsdWRlaGVhZGVycyAtLSIpICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsneC1yZXEnXSA9IGkoJ3gtcmVxJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1yZXEgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsneC1mb3J3YXJkJ10gPSBpKCd4LWZvcndhcmQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LWZvcndhcmQgLS0iKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydhZ2VudCddID0gaSgnYWdlbnQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBVc2VyIEFnZW50IC0tIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Bvc3QnXSA9IGkoJ3Bvc3QnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBwb3N0IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Jhd3Bvc3QnXSA9IGkoJ3Jhd3Bvc3QnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByYXdwb3N0IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2h0bWx1bmVzY2FwZSddID0gaSgnaHRtbHVuZXNjYXBlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgaHRtbHVuZXNjYXBlIikNCg0KDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWFkY29va2llb25seSddID0gaSgncmVhZGNvb2tpZW9ubHknKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByZWFkQ29va2llT25seSIpDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgaQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ10gPSBpKCdjb29raWVqYXInKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXT0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIGNvb2tpZUphciIpCQkJCQkJCQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnc2V0Y29va2llJ10gPSBpKCdzZXRjb29raWUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBzZXRjb29raWUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYXBwZW5kY29va2llJ10gPSBpKCdhcHBlbmRjb29raWUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBhcHBlbmRjb29raWUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICNleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikJCQkNCg0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB1cmxsaWIucXVvdGUocmVwcihyZWdleHMpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzDQogICAgICAgICAgICAgICAgICAgICNwcmludCByZWdleHMNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUNCiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBFcnJvcjogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQojY29waWVzIGZyb20gbGFtZGEncyBpbXBsZW1lbnRhdGlvbg0KZGVmIGdldF91c3RyZWFtKHVybCk6DQogICAgdHJ5Og0KICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1MSk6DQogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQ0KICAgICAgICAgICAgaWYgIkVYVC1YLVNUUkVBTS1JTkYiIGluIHJlc3VsdDogcmV0dXJuIHVybA0KICAgICAgICAgICAgaWYgbm90ICJFWFRNM1UiIGluIHJlc3VsdDogcmV0dXJuDQogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApDQogICAgICAgIHJldHVybg0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuDQogICAgICAgIA0KIA0KZGVmIGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsLGNvb2tpZUphcj1Ob25lLGZvckNvb2tpZUphck9ubHk9RmFsc2UscmVjdXJzaXZlQ2FsbD1GYWxzZSxjYWNoZWRQYWdlcz17fSwgcmF3UG9zdD1GYWxzZSwgY29va2llX2phcl9maWxlPU5vbmUpOiMwLDEsMiA9IFVSTCwgcmVnZXhPbmx5LCBDb29raWVKYXJPbmx5DQogICAgICAgIGlmIG5vdCByZWN1cnNpdmVDYWxsOg0KICAgICAgICAgICAgcmVnZXhzID0gZXZhbCh1cmxsaWIudW5xdW90ZShyZWdleHMpKQ0KICAgICAgICAjY2FjaGVkUGFnZXMgPSB7fQ0KICAgICAgICAjcHJpbnQgJ3VybCcsdXJsDQogICAgICAgIGRvUmVnZXhzID0gcmUuY29tcGlsZSgnXCRkb3JlZ2V4XFsoW15cXV0qKVxdJykuZmluZGFsbCh1cmwpDQogICAgICAgICNwcmludCAnZG9SZWdleHMnLGRvUmVnZXhzLHJlZ2V4cw0KICAgICAgICBzZXRyZXNvbHZlZD1UcnVlDQogICAgICAgICAgICAgIA0KIA0KDQoNCiAgICAgICAgZm9yIGsgaW4gZG9SZWdleHM6DQogICAgICAgICAgICBpZiBrIGluIHJlZ2V4czoNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ3Byb2Nlc3NpbmcgJyAsaw0KICAgICAgICAgICAgICAgIG0gPSByZWdleHNba10NCiAgICAgICAgICAgICAgICAjcHJpbnQgbQ0KICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPUZhbHNlDQoNCg0KICAgICAgICAgICAgICAgIGlmICAnY29va2llamFyJyBpbiBtOiAjIHNvIGVpdGhlciBjcmVhdGUgb3IgcmV1c2UgZXhpc3RpbmcgamFyDQogICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llamFyIGV4aXN0cycsbVsnY29va2llamFyJ10NCiAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09bVsnY29va2llamFyJ10NCiAgICAgICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gY29va2llSmFyUGFyYW06DQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydjb29raWVqYXInXSxjb29raWVKYXIsVHJ1ZSwgVHJ1ZSxjYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ21bY29va2llamFyXScsbVsnY29va2llamFyJ10sY29va2llSmFyDQogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06DQogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphcj09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY3JlYXRlIGNvb2tpZSBqYXInDQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29wZW5bJyBpbiBtWydjb29raWVqYXInXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ29wZW5bJylbMV0uc3BsaXQoJ10nKVswXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldENvb2tpZUphcihjb29raWVfamFyX2ZpbGUpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjb29raWVfamFyX2ZpbGU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsY29va2llX2phcl9maWxlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI2ltcG9ydCBjb29raWVsaWINCiAgICAgICAgICAgICAgICAgICAgICAgICNjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llSmFyIG5ldycsY29va2llSmFyDQogICAgICAgICAgICAgICAgICAgIGVsaWYgJ3NhdmVbJyBpbiBtWydjb29raWVqYXInXToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnc2F2ZVsnKVsxXS5zcGxpdCgnXScpWzBdDQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdjb21wbGV0ZV9wYXRoJyxjb21wbGV0ZV9wYXRoDQogICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpDQogICAgICAgICAgICAgICAgICAgICAgICANCiANCiAgICAgICAgICAgICAgICBpZiAgbVsncGFnZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3BhZ2UnXToNCiAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncGFnZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpDQoNCiAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtIGFuZCBtWydzZXRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydzZXRjb29raWUnXToNCiAgICAgICAgICAgICAgICAgICAgbVsnc2V0Y29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydzZXRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG0gYW5kIG1bJ2FwcGVuZGNvb2tpZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ2FwcGVuZGNvb2tpZSddOg0KICAgICAgICAgICAgICAgICAgICBtWydhcHBlbmRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2FwcGVuZGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpDQoNCiAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgICdwb3N0JyBpbiBtIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3Bvc3QnXToNCiAgICAgICAgICAgICAgICAgICAgbVsncG9zdCddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncG9zdCddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICdwb3N0IGlzIG5vdycsbVsncG9zdCddDQoNCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydyYXdwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcyxyYXdQb3N0PVRydWUpDQogICAgICAgICAgICAgICAgICAgICNwcmludCAncmF3cG9zdCBpcyBub3cnLG1bJ3Jhd3Bvc3QnXQ0KICANCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZSQnIGluIG1bJ3Jhd3Bvc3QnXToNCiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQ0KICANCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZTIkJyBpbiBtWydyYXdwb3N0J106DQogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQ0KDQogIA0KICAgICAgICAgICAgICAgIGxpbms9JycNCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOg0KICAgICAgICAgICAgICAgICAgICBsaW5rID0gY2FjaGVkUGFnZXNbbVsncGFnZSddXQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9zcGxpdD1tWydwYWdlJ10uc3BsaXQoJ3wnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVVybD1wYWdlX3NwbGl0WzBdDQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFnZV9zcGxpdCk+MToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1wYWdlX3NwbGl0WzFdDQogICAgICAgICAgICAgICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QocGFnZVVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3JlZmVyJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXInXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1yZXEnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtZm9yd2FyZCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignWC1Gb3J3YXJkZWQtRm9yJywgbVsneC1mb3J3YXJkJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FwcGVuZGluZyBjb29raWUgdG8gY29va2llamFyJyxtWydhcHBlbmRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPW1bJ2FwcGVuZGNvb2tpZSddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9Y29va2llc3RvQXBlbmQuc3BsaXQoJzsnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGNvb2tpZXN0b0FwZW5kOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcsbj0gbi5zcGxpdCgnOicpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNrID0gY29va2llbGliLkNvb2tpZSh2ZXJzaW9uPTAsIG5hbWU9biwgdmFsdWU9diwgcG9ydD1Ob25lLCBwb3J0X3NwZWNpZmllZD1GYWxzZSwgZG9tYWluPXcsIGRvbWFpbl9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbl9pbml0aWFsX2RvdD1GYWxzZSwgcGF0aD0nLycsIHBhdGhfc3BlY2lmaWVkPVRydWUsIHNlY3VyZT1GYWxzZSwgZXhwaXJlcz1Ob25lLCBkaXNjYXJkPVRydWUsIGNvbW1lbnQ9Tm9uZSwgY29tbWVudF91cmw9Tm9uZSwgcmVzdD17J0h0dHBPbmx5JzogTm9uZX0sIHJmYzIxMDk9RmFsc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphci5zZXRfY29va2llKGNrKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnb3JpZ2luJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdPcmlnaW4nLCBtWydvcmlnaW4nXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhlYWRlcl9pbl9wYWdlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPWhlYWRlcl9pbl9wYWdlLnNwbGl0KCcmJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBoZWFkZXJfaW5fcGFnZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcihuLHYpDQoNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNvb2tpZUphcj09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphclZhbCcsY29va2llSmFyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnbm9yZWRpcmVjdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyMiA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyMikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnY29ubmVjdGlvbicgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5jb25uZWN0aW9uLy8vLy8vLicsbVsnY29ubmVjdGlvbiddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBrZWVwYWxpdmUgaW1wb3J0IEhUVFBIYW5kbGVyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VlcGFsaXZlX2hhbmRsZXIgPSBIVFRQSGFuZGxlcigpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoa2VlcGFsaXZlX2hhbmRsZXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FmdGVyIGNvb2tpZSBqYXInDQogICAgICAgICAgICAgICAgICAgICAgICBwb3N0PU5vbmUNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Bvc3QnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGE9bVsncG9zdCddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0RGF0YToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhcHRjaGFfY2hhbGxlbmdlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGErPSdyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkOicrY2FwdGNoYV9jaGFsbGVuZ2UrJyxyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ6JytjYXRwY2hhX3dvcmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdHBvc3Q9cG9zdERhdGEuc3BsaXQoJywnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0PXt9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHAgaW4gc3BsaXRwb3N0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuPXAuc3BsaXQoJzonKVswXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdj1wLnNwbGl0KCc6JylbMV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Rbbl09dg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QgPSB1cmxsaWIudXJsZW5jb2RlKHBvc3QpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9bVsncmF3cG9zdCddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2FwdGNoYV9jaGFsbGVuZ2UsY2F0cGNoYV93b3JkKT1wcm9jZXNzUmVjYXB0Y2hhKG1bJ3BhZ2UnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QrPScmcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK2NhcHRjaGFfY2hhbGxlbmdlKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrY2F0cGNoYV93b3JkDQoNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBwb3N0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsgPSByZXNwb25zZS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9amF2YXNjcmlwdFVuRXNjYXBlKGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGluayBUaGlzIGp1c3QgcHJpbnQgd2hvbGUgd2VicGFnZSBpbiBMT0cNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdpbmNsdWRlaGVhZGVycycgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz1zdHIocmVzcG9uc2UuaGVhZGVycy5nZXQoJ1NldC1Db29raWUnKSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkUGFnZXNbbVsncGFnZSddXSA9IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N0b3JlIGxpbmsgZm9yJyxtWydwYWdlJ10sZm9yQ29va2llSmFyT25seQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBtWydwYWdlJ10gYW5kICBub3QgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ3BhZ2UnXS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sJycsY29va2llSmFyICkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29va2llSmFyIyBkbyBub3RoaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz12YWwNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1tWydwYWdlJ10NCiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgaW4gbVsnZXhwcmUnXSBvciAnQWN0aXZhdGVXaW5kb3cnICBpbiBtWydleHByZSddICAgb3IgIGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKToNCiAgICAgICAgICAgICAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UNCiAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBtWydleHByZSddOg0KICAgICAgICAgICAgICAgICAgICBtWydleHByZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnZXhwcmUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBub3QgbVsnZXhwcmUnXT09Jyc6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICdkb2luZyBpdCAnLG1bJ2V4cHJlJ10NCiAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtQ2FwdGNoYScgaW4gbVsnZXhwcmUnXToNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1hc2tDYXB0Y2hhKG0sbGluayxjb29raWVKYXIpDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VybCBhbmQgdmFsJyx1cmwsdmFsDQogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBtWydleHByZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdleHBlZWVlZWVlZWVlZWVlZWVlZWVlJyxtWydleHByZSddDQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ2V4cHJlJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLGxpbmssY29va2llSmFyICkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdBY3RpdmF0ZVdpbmRvdycgaW4gbVsnZXhwcmUnXTogcmV0dXJuIA0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3N0aWxsIGhyZScNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmwgayB2YWwnLHVybCxrLHZhbA0KDQogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaW5rPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWcgPSByZS5jb21waWxlKG1bJ2V4cHJlJ10pLnNlYXJjaChsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlZy5ncm91cCgxKS5zdHJpcCgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW1bJ2V4cHJlJ10NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJhd1Bvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Jhd3Bvc3QnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXVybGxpYi5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdodG1sdW5lc2NhcGUnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ZhbD11cmxsaWIudW5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgSFRNTFBhcnNlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1IVE1MUGFyc2VyLkhUTUxQYXJzZXIoKS51bmVzY2FwZSh2YWwpICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICNyZXR1cm4gdmFsDQogICAgICAgICAgICAgICAgZWxzZTogICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsJycpDQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpDQogICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgaWYgJyRHVUlEJCcgaW4gdXJsOg0KICAgICAgICAgICAgaW1wb3J0IHV1aWQNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJEdVSUQkJyxzdHIodXVpZC51dWlkMSgpKS51cHBlcigpKQ0KICAgICAgICBpZiAnJGdldF9jb29raWVzJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpICAgDQoNCiAgICAgICAgaWYgcmVjdXJzaXZlQ2FsbDogcmV0dXJuIHVybA0KICAgICAgICBwcmludCAnZmluYWwgdXJsJyx1cmwNCiAgICAgICAgaWYgdXJsPT0iIjogDQogICAgICAgIAlyZXR1cm4NCiAgICAgICAgZWxzZToNCiAgICAgICAgCXJldHVybiB1cmwsc2V0cmVzb2x2ZWQNCg0KICAgICAgICAgICAgDQogICAgICAgIA0KZGVmIGdldG1kNSh0KToNCiAgICBpbXBvcnQgaGFzaGxpYg0KICAgIGg9aGFzaGxpYi5tZDUoKQ0KICAgIGgudXBkYXRlKHQpDQogICAgcmV0dXJuIGguaGV4ZGlnZXN0KCkNCg0KZGVmIGRlY3J5cHRfdmF1Z2hubGl2ZShlbmNyeXB0ZWQpOg0KICAgIHJldFZhbD0iIg0KICAgIGZvciB2YWwgaW4gZW5jcnlwdGVkLnNwbGl0KCc6Jyk6DQogICAgICAgIHJldFZhbCs9Y2hyKGludCh2YWwucmVwbGFjZSgiMG0wIiwiIikpLzg0LzUpDQogICAgcmV0dXJuIHJldFZhbA0KDQpkZWYgcGxheW1lZGlhKG1lZGlhX3VybCk6DQogICAgdHJ5Og0KICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcg0KICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkNCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gIkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkNCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkNCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQ0KICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOg0KICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDApDQogICAgZXhjZXB0Og0KICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCiAgICByZXR1cm4gJycNCiAgICANCiAgICAgICAgDQpkZWYgZ2V0X3Nhd19ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6DQogICAgaWYgcmVmZXJlcjoNCiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0NCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgcGFnZV91cmw9cGFnZV92YWx1ZQ0KICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpDQoNCiAgICBzdHJfcGF0dGVybj0iKGV2YWxcKGZ1bmN0aW9uXChwLGEsYyxrLGUsKD86cnxkKS4qKSINCg0KICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKQ0KICAgIHI9IiINCiAgICBpZiByZWdfcmVzIGFuZCBsZW4ocmVnX3Jlcyk+MDoNCiAgICAgICAgZm9yIHYgaW4gcmVnX3JlczoNCiAgICAgICAgICAgIHIxPWdldF91bnBhY2tlZCh2KQ0KICAgICAgICAgICAgcjI9cmVfbWUocjEsJ1wnKC4qPylcJycpDQogICAgICAgICAgICBpZiAndW5lc2NhcGUnIGluIHIxOg0KICAgICAgICAgICAgICAgIHIxPXVybGxpYi51bnF1b3RlKHIyKQ0KICAgICAgICAgICAgcis9cjErJ1xuJw0KICAgICAgICBwcmludCAnZmluYWwgdmFsdWUgaXMgJyxyDQogICAgICAgIA0KICAgICAgICBwYWdlX3VybD1yZV9tZShyLCdzcmM9IiguKj8pIicpDQogICAgICAgIA0KICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV91cmwsaGVhZGVycz1yZWZlcmVyKQ0KDQogICAgI3ByaW50IHBhZ2VfdmFsdWUNCg0KICAgIHJ0bXA9cmVfbWUocGFnZV92YWx1ZSwnc3RyZWFtZXJcJy4qP1wnKC4qPylcJ1wpJykNCiAgICBwbGF5cGF0aD1yZV9tZShwYWdlX3ZhbHVlLCdmaWxlXCcsXHNcJyguKj8pXCcnKQ0KDQogICAgDQogICAgcmV0dXJuIHJ0bXArJyBwbGF5cGF0aD0nK3BsYXlwYXRoICsnIHBhZ2VVcmw9JytwYWdlX3VybA0KICAgIA0KZGVmIGdldF9sZXRvbl9ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6DQogICAgaWYgcmVmZXJlcjoNCiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0NCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUsaGVhZGVycz1yZWZlcmVyKQ0KICAgIHN0cl9wYXR0ZXJuPSJ2YXIgYSA9ICguKj8pO1xzKnZhciBiID0gKC4qPyk7XHMqdmFyIGMgPSAoLio/KTtccyp2YXIgZCA9ICguKj8pO1xzKnZhciBmID0gKC4qPyk7XHMqdmFyIHZfcGFydCA9ICcoLio/KSc7Ig0KICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKVswXSANCg0KICAgIGEsYixjLGQsZix2PShyZWdfcmVzKQ0KICAgIGY9aW50KGYpDQogICAgYT1pbnQoYSkvZg0KICAgIGI9aW50KGIpL2YNCiAgICBjPWludChjKS9mDQogICAgZD1pbnQoZCkvZg0KDQogICAgcmV0PSAncnRtcDovLycgKyBzdHIoYSkgKyAnLicgKyBzdHIoYikgKyAnLicgKyBzdHIoYykgKyAnLicgKyBzdHIoZCkgKyB2Ow0KICAgIHJldHVybiByZXQNCg0KZGVmIGNyZWF0ZU0zdUZvckRhc2godXJsLHVzZXJhZ2VudD1Ob25lKToNCiAgICBzdHI9JyNFWFRNM1UnDQogICAgc3RyKz0nXG4jRVhULVgtU1RSRUFNLUlORjpQUk9HUkFNLUlEPTEsQkFORFdJRFRIPTM2MTgxNicNCiAgICBzdHIrPSdcbicrdXJsKycmYnl0ZXM9MC0yMDAwMDAnIysnfFVzZXItQWdlbnQ9Jyt1c2VyYWdlbnQNCiAgICBzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAndGVzdGZpbGUubTN1JykNCiAgICBzdHIrPSdcbicNCiAgICBTYXZlVG9GaWxlKHNvdXJjZV9maWxlLHN0cikNCiAgICAjcmV0dXJuICdDOi9Vc2Vycy9zaGFuaS9Eb3dubG9hZHMvdGVzdC5tM3U4Jw0KICAgIHJldHVybiBzb3VyY2VfZmlsZQ0KDQpkZWYgU2F2ZVRvRmlsZShmaWxlX25hbWUscGFnZV9kYXRhLGFwcGVuZD1GYWxzZSk6DQogICAgaWYgYXBwZW5kOg0KICAgICAgICBmID0gb3BlbihmaWxlX25hbWUsICdhJykNCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpDQogICAgICAgIGYuY2xvc2UoKSAgICAgICAgDQogICAgZWxzZToNCiAgICAgICAgZj1vcGVuKGZpbGVfbmFtZSwnd2InKQ0KICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkNCiAgICAgICAgZi5jbG9zZSgpDQogICAgICAgIHJldHVybiAnJw0KICAgIA0KZGVmIExvYWRGaWxlKGZpbGVfbmFtZSk6DQoJZj1vcGVuKGZpbGVfbmFtZSwncmInKQ0KCWQ9Zi5yZWFkKCkNCglmLmNsb3NlKCkNCglyZXR1cm4gZA0KICAgIA0KZGVmIGdldF9wYWNrZWRfaXBob25ldHZfdXJsKHBhZ2VfZGF0YSk6DQoJaW1wb3J0IHJlLGJhc2U2NCx1cmxsaWI7IA0KCXM9cGFnZV9kYXRhDQoJd2hpbGUgJ2dlaCgnIGluIHM6DQoJCWlmIHMuc3RhcnRzd2l0aCgnbG9sKCcpOiBzPXNbNTotMV0gICAgDQojCQlwcmludCAncyBpcyAnLHMNCgkJcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXTsgDQoJCXM9ICBiYXNlNjQuYjY0ZGVjb2RlKHMpOyANCgkJcz11cmxsaWIudW5xdW90ZShzKTsgDQoJcHJpbnQgcw0KCXJldHVybiBzDQoNCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToNCiAgICBwcmludCAnZ2V0X2RhZ191cmwyJyxwYWdlX2RhdGENCiAgICBwYWdlX2RhdGEyPWdldFVybChwYWdlX2RhdGEpOw0KICAgIHBhdHQ9JyhodHRwLiopJw0KICAgIGltcG9ydCB1dWlkDQogICAgcGxheWJhY2s9c3RyKHV1aWQudXVpZDEoKSkudXBwZXIoKQ0KICAgIGxpbmtzPXJlLmNvbXBpbGUocGF0dCkuZmluZGFsbChwYWdlX2RhdGEyKQ0KICAgIGhlYWRlcnM9WygnWC1QbGF5YmFjay1TZXNzaW9uLUlkJyxwbGF5YmFjayldDQogICAgZm9yIGwgaW4gbGlua3M6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwYWdlX2RhdGF0ZW1wPWdldFVybChsLGhlYWRlcnM9aGVhZGVycyk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICANCiAgICByZXR1cm4gcGFnZV9kYXRhKyd8JlgtUGxheWJhY2stU2Vzc2lvbi1JZD0nK3BsYXliYWNrDQoNCiAgICANCmRlZiBnZXRfZGFnX3VybChwYWdlX2RhdGEpOg0KICAgIHByaW50ICdnZXRfZGFnX3VybCcscGFnZV9kYXRhDQogICAgaWYgcGFnZV9kYXRhLnN0YXJ0c3dpdGgoJ2h0dHA6Ly9kYWcudG90YWwtc3RyZWFtLm5ldCcpOg0KICAgICAgICBoZWFkZXJzPVsoJ1VzZXItQWdlbnQnLCdWZXJpc21vLUJsYWNrVUlfKDIuNC43LjUuOC4wLjM0KScpXQ0KICAgICAgICBwYWdlX2RhdGE9Z2V0VXJsKHBhZ2VfZGF0YSxoZWFkZXJzPWhlYWRlcnMpOw0KDQogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOg0KICAgICAgICByZXR1cm4gcmV2aXN0X2RhZyhwYWdlX2RhdGEpDQogICAgZWxpZiByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgIT0gJyc6DQogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpDQogICAgZWxzZToNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnaHJlZj0iKFteIl0rKSJbXiJdKyQnKQ0KICAgICAgICBpZiBsZW4oZmluYWxfdXJsKT09MDoNCiAgICAgICAgICAgIGZpbmFsX3VybD1wYWdlX2RhdGENCiAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnICcsICclMjAnKQ0KICAgIHJldHVybiBmaW5hbF91cmwNCg0KZGVmIHJlX21lKGRhdGEsIHJlX3BhdHRlbik6DQogICAgbWF0Y2ggPSAnJw0KICAgIG0gPSByZS5zZWFyY2gocmVfcGF0dGVuLCBkYXRhKQ0KICAgIGlmIG0gIT0gTm9uZToNCiAgICAgICAgbWF0Y2ggPSBtLmdyb3VwKDEpDQogICAgZWxzZToNCiAgICAgICAgbWF0Y2ggPSAnJw0KICAgIHJldHVybiBtYXRjaA0KDQpkZWYgcmV2aXN0X2RhZyhwYWdlX2RhdGEpOg0KICAgIGZpbmFsX3VybCA9ICcnDQogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICcgbGl2ZT10cnVlIHRpbWVvdXQ9MTUgcGxheXBhdGg9JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFthLXpBLVowLTktX1xcLkBdKyknKQ0KICAgICAgICANCiAgICBpZiByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpICE9ICcnOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwgKyAnP3Rva2VuPScgKyByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpDQogICAgZWxpZiByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgIT0gJyc6DQogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpDQogICAgZWxzZToNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnSFJFRj0iKFteIl0rKSInKQ0KDQogICAgaWYgJ2RhZzEuYXN4JyBpbiBmaW5hbF91cmw6DQogICAgICAgIHJldHVybiBnZXRfZGFnX3VybChmaW5hbF91cmwpDQoNCiAgICBpZiAnZGV2aW5saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoNCiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ2RldmlubGl2ZScsICdmbGl2ZScpDQogICAgaWYgJ3Blcm1saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoNCiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ3Blcm1saXZlJywgJ2ZsaXZlJykNCiAgICByZXR1cm4gZmluYWxfdXJsDQoNCg0KZGVmIGdldF91bndpc2UoIHN0cl9ldmFsKToNCiAgICBwYWdlX3ZhbHVlPSIiDQogICAgdHJ5OiAgICAgICAgDQogICAgICAgIHNzPSJ3LGkscyxlPSgiK3N0cl9ldmFsKycpJyANCiAgICAgICAgZXhlYyAoc3MpDQogICAgICAgIHBhZ2VfdmFsdWU9dW53aXNlX2Z1bmModyxpLHMsZSkNCiAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQ0KICAgICNwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUNCiAgICByZXR1cm4gcGFnZV92YWx1ZQ0KICAgIA0KZGVmIHVud2lzZV9mdW5jKCB3LCBpLCBzLCBlKToNCiAgICBsSWxsID0gMDsNCiAgICBsbDFJID0gMDsNCiAgICBJbDFsID0gMDsNCiAgICBsbDFsID0gW107DQogICAgbDFsSSA9IFtdOw0KICAgIHdoaWxlIFRydWU6DQogICAgICAgIGlmIChsSWxsIDwgNSk6DQogICAgICAgICAgICBsMWxJLmFwcGVuZCh3W2xJbGxdKQ0KICAgICAgICBlbGlmIChsSWxsIDwgbGVuKHcpKToNCiAgICAgICAgICAgIGxsMWwuYXBwZW5kKHdbbElsbF0pOw0KICAgICAgICBsSWxsKz0xOw0KICAgICAgICBpZiAobGwxSSA8IDUpOg0KICAgICAgICAgICAgbDFsSS5hcHBlbmQoaVtsbDFJXSkNCiAgICAgICAgZWxpZiAobGwxSSA8IGxlbihpKSk6DQogICAgICAgICAgICBsbDFsLmFwcGVuZChpW2xsMUldKQ0KICAgICAgICBsbDFJKz0xOw0KICAgICAgICBpZiAoSWwxbCA8IDUpOg0KICAgICAgICAgICAgbDFsSS5hcHBlbmQoc1tJbDFsXSkNCiAgICAgICAgZWxpZiAoSWwxbCA8IGxlbihzKSk6DQogICAgICAgICAgICBsbDFsLmFwcGVuZChzW0lsMWxdKTsNCiAgICAgICAgSWwxbCs9MTsNCiAgICAgICAgaWYgKGxlbih3KSArIGxlbihpKSArIGxlbihzKSArIGxlbihlKSA9PSBsZW4obGwxbCkgKyBsZW4obDFsSSkgKyBsZW4oZSkpOg0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIA0KICAgIGxJMWwgPSAnJy5qb2luKGxsMWwpIy5qb2luKCcnKTsNCiAgICBJMWxJID0gJycuam9pbihsMWxJKSMuam9pbignJyk7DQogICAgbGwxSSA9IDA7DQogICAgbDFsbCA9IFtdOw0KICAgIGZvciBsSWxsIGluIHJhbmdlKDAsbGVuKGxsMWwpLDIpOg0KICAgICAgICAjcHJpbnQgJ2FycmF5IGknLGxJbGwsbGVuKGxsMWwpDQogICAgICAgIGxsMTEgPSAtMTsNCiAgICAgICAgaWYgKCBvcmQoSTFsSVtsbDFJXSkgJSAyKToNCiAgICAgICAgICAgIGxsMTEgPSAxOw0KICAgICAgICAjcHJpbnQgJ3ZhbCBpcyAnLCBsSTFsW2xJbGw6IGxJbGwrMl0NCiAgICAgICAgbDFsbC5hcHBlbmQoY2hyKCAgICBpbnQobEkxbFtsSWxsOiBsSWxsKzJdLCAzNikgLSBsbDExKSk7DQogICAgICAgIGxsMUkrPTE7DQogICAgICAgIGlmIChsbDFJID49IGxlbihsMWxJKSk6DQogICAgICAgICAgICBsbDFJID0gMDsNCiAgICByZXQ9Jycuam9pbihsMWxsKQ0KICAgIGlmICdldmFsKGZ1bmN0aW9uKHcsaSxzLGUpJyBpbiByZXQ6DQogICAgICAgIHByaW50ICdTVElMTCBHT2luZycNCiAgICAgICAgcmV0PXJlLmNvbXBpbGUoJ2V2YWxcKGZ1bmN0aW9uXCh3LGkscyxlXCkuKn1cKCguKj8pXCknKS5maW5kYWxsKHJldClbMF0gDQogICAgICAgIHJldHVybiBnZXRfdW53aXNlKHJldCkNCiAgICBlbHNlOg0KICAgICAgICBwcmludCAnRklOSVNIRUQnDQogICAgICAgIHJldHVybiByZXQNCiAgICANCmRlZiBnZXRfdW5wYWNrZWQoIHBhZ2VfdmFsdWUsIHJlZ2V4X2Zvcl90ZXh0PScnLCBpdGVyYXRpb25zPTEsIHRvdGFsX2l0ZXJhdGlvbj0xKToNCiAgICB0cnk6ICAgICAgICANCiAgICAgICAgcmVnX2RhdGE9Tm9uZQ0KICAgICAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlKQ0KICAgICAgICBwcmludCAncGFnZV92YWx1ZScscGFnZV92YWx1ZQ0KICAgICAgICBpZiByZWdleF9mb3JfdGV4dCBhbmQgbGVuKHJlZ2V4X2Zvcl90ZXh0KT4wOg0KICAgICAgICAgICAgcGFnZV92YWx1ZT1yZS5jb21waWxlKHJlZ2V4X2Zvcl90ZXh0KS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdICNnZXQgdGhlIGpzIHZhcmlhYmxlDQogICAgICAgIA0KICAgICAgICBwYWdlX3ZhbHVlPXVucGFjayhwYWdlX3ZhbHVlLGl0ZXJhdGlvbnMsdG90YWxfaXRlcmF0aW9uKQ0KICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpDQogICAgcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlDQogICAgaWYgJ3NhdjFsaXZlLnR2JyBpbiBwYWdlX3ZhbHVlOg0KICAgICAgICBwYWdlX3ZhbHVlPXBhZ2VfdmFsdWUucmVwbGFjZSgnc2F2MWxpdmUudHYnLCdzYXdsaXZlLnR2JykgI3F1aWNrIGZpeCBzb21lIGJ1ZyBzb21ld2hlcmUNCiAgICAgICAgcHJpbnQgJ3NhdjEgdW5wYWNrZWQnLHBhZ2VfdmFsdWUNCiAgICByZXR1cm4gcGFnZV92YWx1ZQ0KDQpkZWYgdW5wYWNrKHNKYXZhc2NyaXB0LGl0ZXJhdGlvbj0xLCB0b3RhbGl0ZXJhdGlvbnM9MiAgKToNCiAgICBwcmludCAnaXRlcmF0aW9uJyxpdGVyYXRpb24NCiAgICBpZiBzSmF2YXNjcmlwdC5zdGFydHN3aXRoKCd2YXIgXzB4Y2I4YT0nKToNCiAgICAgICAgYVNwbGl0PXNKYXZhc2NyaXB0LnNwbGl0KCd2YXIgXzB4Y2I4YT0nKQ0KICAgICAgICBzcz0ibXlhcnJheT0iK2FTcGxpdFsxXS5zcGxpdCgiZXZhbCgiKVswXQ0KICAgICAgICBleGVjKHNzKQ0KICAgICAgICBhMT02Mg0KICAgICAgICBjMT1pbnQoYVNwbGl0WzFdLnNwbGl0KCIsNjIsIilbMV0uc3BsaXQoJywnKVswXSkNCiAgICAgICAgcDE9bXlhcnJheVswXQ0KICAgICAgICBrMT1teWFycmF5WzNdDQogICAgICAgIHdpdGggb3BlbigndGVtcCBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoNCiAgICAgICAgICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKGsxKSkNCiAgICAgICAgI2FhPTEvMA0KICAgIGVsc2U6DQoNCiAgICAgICAgYVNwbGl0ID0gc0phdmFzY3JpcHQuc3BsaXQoInJuIHB9KCciKQ0KICAgICAgICBwcmludCBhU3BsaXQNCiAgICAgICAgDQogICAgICAgIHAxLGExLGMxLGsxPSgnJywnMCcsJzAnLCcnKQ0KICAgICANCiAgICAgICAgc3M9InAxLGExLGMxLGsxPSgnIithU3BsaXRbMV0uc3BsaXQoIi5zcGxpIilbMF0rJyknIA0KICAgICAgICBleGVjKHNzKQ0KICAgIGsxPWsxLnNwbGl0KCd8JykNCiAgICBhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIikpJyIpDQojICAgIHByaW50ICcgcCBhcnJheSBpcyAnLGxlbihhU3BsaXQpDQojICAgcHJpbnQgbGVuKGFTcGxpdCApDQoNCiAgICAjcD1zdHIoYVNwbGl0WzBdKycpKScpIy5yZXBsYWNlKCJcXCIsIiIpIy5yZXBsYWNlKCdcXFxcJywnXFwnKQ0KDQogICAgI3ByaW50IGFTcGxpdFsxXQ0KICAgICNhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIiwiKQ0KICAgICNwcmludCBhU3BsaXRbMF0gDQogICAgI2EgPSBpbnQoYVNwbGl0WzFdKQ0KICAgICNjID0gaW50KGFTcGxpdFsyXSkNCiAgICAjayA9IGFTcGxpdFszXS5zcGxpdCgiLiIpWzBdLnJlcGxhY2UoIiciLCAnJykuc3BsaXQoJ3wnKQ0KICAgICNhPWludChhKQ0KICAgICNjPWludChjKQ0KICAgIA0KICAgICNwPXAucmVwbGFjZSgnXFwnLCAnJykNCiMgICAgcHJpbnQgJ3AgdmFsIGlzICcscFswOjEwMF0sJy4uLi4uLi4uLi4uLicscFstMTAwOl0sbGVuKHApDQojICAgIHByaW50ICdwMSB2YWwgaXMgJyxwMVswOjEwMF0sJy4uLi4uLi4uLi4uLicscDFbLTEwMDpdLGxlbihwMSkNCiAgICANCiAgICAjcHJpbnQgYSxhMQ0KICAgICNwcmludCBjLGExDQogICAgI3ByaW50ICdrIHZhbCBpcyAnLGtbLTEwOl0sbGVuKGspDQojICAgIHByaW50ICdrMSB2YWwgaXMgJyxrMVstMTA6XSxsZW4oazEpDQogICAgZSA9ICcnDQogICAgZCA9ICcnIzMyODIzDQoNCiAgICAjc1VucGFja2VkID0gc3RyKF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQpKQ0KICAgIHNVbnBhY2tlZDEgPSBzdHIoX191bnBhY2socDEsIGExLCBjMSwgazEsIGUsIGQsaXRlcmF0aW9uKSkNCiAgICANCiAgICAjcHJpbnQgc1VucGFja2VkWzoyMDBdKycuLi4uJytzVW5wYWNrZWRbLTEwMDpdLCBsZW4oc1VucGFja2VkKQ0KIyAgICBwcmludCBzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpDQogICAgDQogICAgI2V4ZWMoJ3NVbnBhY2tlZDE9Iicrc1VucGFja2VkMSsnIicpDQogICAgaWYgaXRlcmF0aW9uPj10b3RhbGl0ZXJhdGlvbnM6DQojICAgICAgICBwcmludCAnZmluYWwgcmVzJyxzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpDQogICAgICAgIHJldHVybiBzVW5wYWNrZWQxIy5yZXBsYWNlKCdcXFxcJywgJ1xcJykNCiAgICBlbHNlOg0KIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcyBmb3IgdGhpcyBpdGVyYXRpb24gaXMnLGl0ZXJhdGlvbg0KICAgICAgICByZXR1cm4gdW5wYWNrKHNVbnBhY2tlZDEsaXRlcmF0aW9uKzEpIy5yZXBsYWNlKCdcXCcsICcnKSxpdGVyYXRpb24pIy5yZXBsYWNlKCdcXCcsICcnKTsjdW5wYWNrKHNVbnBhY2tlZC5yZXBsYWNlKCdcXCcsICcnKSkNCg0KZGVmIF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQsIGl0ZXJhdGlvbix2PTEpOg0KDQogICAgI3dpdGggb3BlbignYmVmb3JlIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOg0KICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpDQogICAgd2hpbGUgKGMgPj0gMSk6DQogICAgICAgIGMgPSBjIC0xDQogICAgICAgIGlmIChrW2NdKToNCiAgICAgICAgICAgIGFhPXN0cihfX2l0b2FOZXcoYywgYSkpDQogICAgICAgICAgICBpZiB2PT0xOg0KICAgICAgICAgICAgICAgIHA9cmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKSMgVEhJUyBJUyBCbG9vZHkgc2xvdyENCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcD1maW5kQW5kUmVwbGFjZVdvcmQocCxhYSxrW2NdKQ0KDQogICAgICAgICAgICAjcD1maW5kQW5kUmVwbGFjZVdvcmQocCxhYSxrW2NdKQ0KDQogICAgICAgICAgICANCiAgICAjd2l0aCBvcGVuKCdhZnRlciBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoNCiAgICAjICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKHApKQ0KICAgIHJldHVybiBwDQoNCiMNCiNmdW5jdGlvbiBlcXVhbGF2ZW50IHRvIHJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkNCmRlZiBmaW5kQW5kUmVwbGFjZVdvcmQoc291cmNlX3N0ciwgd29yZF90b19maW5kLHJlcGxhY2Vfd2l0aCk6DQogICAgc3BsaXRzPU5vbmUNCiAgICBzcGxpdHM9c291cmNlX3N0ci5zcGxpdCh3b3JkX3RvX2ZpbmQpDQogICAgaWYgbGVuKHNwbGl0cyk+MToNCiAgICAgICAgbmV3X3N0cmluZz1bXQ0KICAgICAgICBjdXJyZW50X2luZGV4PTANCiAgICAgICAgZm9yIGN1cnJlbnRfc3BsaXQgaW4gc3BsaXRzOg0KICAgICAgICAgICAgI3ByaW50ICdoZXJlJyxpDQogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZChjdXJyZW50X3NwbGl0KQ0KICAgICAgICAgICAgdmFsPXdvcmRfdG9fZmluZCNieSBkZWZhdWx0IGFzc3VtZSBpdCB3YXMgd3JvbmcgdG8gc3BsaXQNCg0KICAgICAgICAgICAgI2lmIGl0cyBmaXJzdCBvbmUgYW5kIGl0ZW0gaXMgYmxhbmsgdGhlbiBjaGVjayBuZXh0IGl0ZW0gaXMgdmFsaWQgb3Igbm90DQogICAgICAgICAgICBpZiBjdXJyZW50X2luZGV4PT1sZW4oc3BsaXRzKS0xOg0KICAgICAgICAgICAgICAgIHZhbD0nJyAjIGxhc3Qgb25lIG5vdGhpbmcgdG8gYXBwZW5kIG5vcm1hbGx5DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X3NwbGl0KT09MDogI2lmIGJsYW5rIGNoZWNrIG5leHQgb25lIHdpdGggY3VycmVudCBzcGxpdCB2YWx1ZQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpOiMgZmlyc3QganVzdCBqdXN0IGNoZWNrIG5leHQNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZXBsYWNlX3dpdGgNCiAgICAgICAgICAgICAgICAjbm90IGJsYW5rLCB0aGVuIGNoZWNrIGN1cnJlbnQgZW5kdmFsdWUgYW5kIG5leHQgZmlyc3QgdmFsdWUNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRzW2N1cnJlbnRfaW5kZXhdWy0xXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIGFuZCAoKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aA0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZCh2YWwpDQogICAgICAgICAgICBjdXJyZW50X2luZGV4Kz0xDQogICAgICAgICNhYWFhPTEvMA0KICAgICAgICBzb3VyY2Vfc3RyPScnLmpvaW4obmV3X3N0cmluZykNCiAgICByZXR1cm4gc291cmNlX3N0ciAgICAgICAgDQoNCmRlZiBfX2l0b2EobnVtLCByYWRpeCk6DQojICAgIHByaW50ICdudW0gcmVkJyxudW0sIHJhZGl4DQogICAgcmVzdWx0ID0gIiINCiAgICBpZiBudW09PTA6IHJldHVybiAnMCcNCiAgICB3aGlsZSBudW0gPiAwOg0KICAgICAgICByZXN1bHQgPSAiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IltudW0gJSByYWRpeF0gKyByZXN1bHQNCiAgICAgICAgbnVtIC89IHJhZGl4DQogICAgcmV0dXJuIHJlc3VsdA0KCQ0KZGVmIF9faXRvYU5ldyhjYywgYSk6DQogICAgYWE9IiIgaWYgY2MgPCBhIGVsc2UgX19pdG9hTmV3KGludChjYyAvIGEpLGEpIA0KICAgIGNjID0gKGNjICUgYSkNCiAgICBiYj1jaHIoY2MgKyAyOSkgaWYgY2M+IDM1IGVsc2Ugc3RyKF9faXRvYShjYywzNikpDQogICAgcmV0dXJuIGFhK2JiDQoNCg0KZGVmIGdldENvb2tpZXNTdHJpbmcoY29va2llSmFyKToNCiAgICB0cnk6DQogICAgICAgIGNvb2tpZVN0cmluZz0iIg0KICAgICAgICBmb3IgaW5kZXgsIGNvb2tpZSBpbiBlbnVtZXJhdGUoY29va2llSmFyKToNCiAgICAgICAgICAgIGNvb2tpZVN0cmluZys9Y29va2llLm5hbWUgKyAiPSIgKyBjb29raWUudmFsdWUgKyI7Ig0KICAgIGV4Y2VwdDogcGFzcw0KICAgICNwcmludCAnY29va2llU3RyaW5nJyxjb29raWVTdHJpbmcNCiAgICByZXR1cm4gY29va2llU3RyaW5nDQoNCg0KZGVmIHNhdmVDb29raWVKYXIoY29va2llSmFyLENPT0tJRUZJTEUpOg0KCXRyeToNCgkJY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxDT09LSUVGSUxFKQ0KCQljb29raWVKYXIuc2F2ZShjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpDQoJZXhjZXB0OiBwYXNzDQoNCmRlZiBnZXRDb29raWVKYXIoQ09PS0lFRklMRSk6DQoNCgljb29raWVKYXI9Tm9uZQ0KCWlmIENPT0tJRUZJTEU6DQoJCXRyeToNCgkJCWNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkNCgkJCWNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQ0KCQkJY29va2llSmFyLmxvYWQoY29tcGxldGVfcGF0aCxpZ25vcmVfZGlzY2FyZD1UcnVlKQ0KCQlleGNlcHQ6IA0KCQkJY29va2llSmFyPU5vbmUNCgkNCglpZiBub3QgY29va2llSmFyOg0KCQljb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkNCgkNCglyZXR1cm4gY29va2llSmFyDQogICAgDQpkZWYgZG9FdmFsKGZ1bl9jYWxsLHBhZ2VfZGF0YSxDb29raWVfSmFyKToNCiAgICByZXRfdmFsPScnDQogICAgaWYgZnVuY3Rpb25zX2RpciBub3QgaW4gc3lzLnBhdGg6DQogICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQ0KICAgIA0KICAgIHByaW50IGZ1bl9jYWxsDQogICAgdHJ5Og0KICAgICAgICBweV9maWxlPSdpbXBvcnQgJytmdW5fY2FsbC5zcGxpdCgnLicpWzBdDQogICAgICAgIHByaW50IHB5X2ZpbGUsc3lzLnBhdGgNCiAgICAgICAgZXhlYyggcHlfZmlsZSkNCiAgICAgICAgcHJpbnQgJ2RvbmUnDQogICAgZXhjZXB0Og0KICAgICAgICBwcmludCAnZXJyb3IgaW4gaW1wb3J0Jw0KICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkNCiAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsDQogICAgZXhlYyAoJ3JldF92YWw9JytmdW5fY2FsbCkNCiAgICBwcmludCByZXRfdmFsDQogICAgI2V4ZWMoJ3JldF92YWw9MSsxJykNCiAgICByZXR1cm4gc3RyKHJldF92YWwpDQogICAgDQpkZWYgcHJvY2Vzc1JlY2FwdGNoYSh1cmwpOg0KCWh0bWxfdGV4dD1nZXRVcmwodXJsKQ0KCXJlY2FwQ2hhbGxlbmdlPSIiDQoJc29sdXRpb249IiINCgljYXBfcmVnPSI8c2NyaXB0Lio/c3JjPVwiKC4qP3JlY2FwLio/KVwiIg0KCW1hdGNoID1yZS5maW5kYWxsKGNhcF9yZWcsIGh0bWxfdGV4dCkNCgljYXB0Y2hhPUZhbHNlDQoJY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9Tm9uZQ0KCXNvbHV0aW9uPU5vbmUNCgkNCglpZiBtYXRjaCBhbmQgbGVuKG1hdGNoKT4wOiAjbmV3IHNoaW55IGNhcHRjaGEhDQoJCWNhcHRjaGFfdXJsPW1hdGNoWzBdDQoJCWNhcHRjaGE9VHJ1ZQ0KCQkNCgkJY2FwX2NoYWxsX3JlZz0nY2hhbGxlbmdlLio/XCcoLio/KVwnJw0KCQljYXBfaW1hZ2VfcmVnPSdcJyguKj8pXCcnDQoJCWNhcHRjaGFfc2NyaXB0PWdldFVybChjYXB0Y2hhX3VybCkNCgkJcmVjYXBDaGFsbGVuZ2U9cmUuZmluZGFsbChjYXBfY2hhbGxfcmVnLCBjYXB0Y2hhX3NjcmlwdClbMF0NCgkJY2FwdGNoYV9yZWxvYWQ9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3JlbG9hZD9jPSc7DQoJCWNhcHRjaGFfaz1jYXB0Y2hhX3VybC5zcGxpdCgnaz0nKVsxXQ0KCQljYXB0Y2hhX3JlbG9hZCs9cmVjYXBDaGFsbGVuZ2UrJyZrPScrY2FwdGNoYV9rKycmY2FwdGNoYV9rPTEmdHlwZT1pbWFnZSZsYW5nPWVuLUdCJw0KCQljYXB0Y2hhX3JlbG9hZF9qcz1nZXRVcmwoY2FwdGNoYV9yZWxvYWQpDQoJCWNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsPXJlLmZpbmRhbGwoY2FwX2ltYWdlX3JlZywgY2FwdGNoYV9yZWxvYWRfanMpWzBdDQoJCWNhcHRjaGFfaW1hZ2VfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS9pbWFnZT9jPScrY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwNCgkJaWYgbm90IGNhcHRjaGFfaW1hZ2VfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToNCgkJCWNhcHRjaGFfaW1hZ2VfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS8nK2NhcHRjaGFfaW1hZ2VfdXJsDQoJCWltcG9ydCByYW5kb20NCgkJbj1yYW5kb20ucmFuZHJhbmdlKDEwMCwxMDAwLDUpDQoJCWxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSxzdHIobikgKyJjYXB0Y2hhLmltZyIgKQ0KCQlsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpDQoJCWxvY2FsRmlsZS53cml0ZShnZXRVcmwoY2FwdGNoYV9pbWFnZV91cmwpKQ0KCQlsb2NhbEZpbGUuY2xvc2UoKQ0KCQlzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpDQoJCXNvbHV0aW9uID0gc29sdmVyLmdldCgpDQoJCW9zLnJlbW92ZShsb2NhbF9jYXB0Y2hhKQ0KCXJldHVybiBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCAsc29sdXRpb24NCg0KZGVmIGdldFVybCh1cmwsIGNvb2tpZUphcj1Ob25lLHBvc3Q9Tm9uZSwgdGltZW91dD0yMCwgaGVhZGVycz1Ob25lKToNCg0KDQoJY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQ0KCW9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCgkjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQoJcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkNCglyZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMy4wLjE3NTAuMTU0IFNhZmFyaS81MzcuMzYnKQ0KCWlmIGhlYWRlcnM6DQoJCWZvciBoLGh2IGluIGhlYWRlcnM6DQoJCQlyZXEuYWRkX2hlYWRlcihoLGh2KQ0KDQoJcmVzcG9uc2UgPSBvcGVuZXIub3BlbihyZXEscG9zdCx0aW1lb3V0PXRpbWVvdXQpDQoJbGluaz1yZXNwb25zZS5yZWFkKCkNCglyZXNwb25zZS5jbG9zZSgpDQoJcmV0dXJuIGxpbms7DQoNCmRlZiBnZXRfZGVjb2RlKHN0cixyZWc9Tm9uZSk6DQoJaWYgcmVnOg0KCQlzdHI9cmUuZmluZGFsbChyZWcsIHN0cilbMF0NCglzMSA9IHVybGxpYi51bnF1b3RlKHN0clswOiBsZW4oc3RyKS0xXSk7DQoJdCA9ICcnOw0KCWZvciBpIGluIHJhbmdlKCBsZW4oczEpKToNCgkJdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pOw0KCXQ9dXJsbGliLnVucXVvdGUodCkNCglwcmludCB0DQoJcmV0dXJuIHQNCg0KZGVmIGphdmFzY3JpcHRVbkVzY2FwZShzdHIpOg0KCWpzPXJlLmZpbmRhbGwoJ3VuZXNjYXBlXChcJyguKj8pXCcnLHN0cikNCglwcmludCAnanMnLGpzDQoJaWYgKG5vdCBqcz09Tm9uZSkgYW5kIGxlbihqcyk+MDoNCgkJZm9yIGogaW4ganM6DQoJCQkjcHJpbnQgdXJsbGliLnVucXVvdGUoaikNCgkJCXN0cj1zdHIucmVwbGFjZShqICx1cmxsaWIudW5xdW90ZShqKSkNCglyZXR1cm4gc3RyDQoNCmlpZD0wDQpkZWYgYXNrQ2FwdGNoYShtLGh0bWxfcGFnZSwgY29va2llSmFyKToNCiAgICBnbG9iYWwgaWlkDQogICAgaWlkKz0xDQogICAgZXhwcmU9IG1bJ2V4cHJlJ10NCiAgICBwYWdlX3VybCA9IG1bJ3BhZ2UnXQ0KICAgIGNhcHRjaGFfcmVnZXg9cmUuY29tcGlsZSgnXCRMaXZlU3RyZWFtQ2FwdGNoYVxbKFteXF1dKilcXScpLmZpbmRhbGwoZXhwcmUpWzBdDQoNCiAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGNhcHRjaGFfcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQ0KICAgIHByaW50IGV4cHJlLGNhcHRjaGFfcmVnZXgsY2FwdGNoYV91cmwNCiAgICBpZiBub3QgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICBwYWdlXz0naHR0cDovLycrIiIuam9pbihwYWdlX3VybC5zcGxpdCgnLycpWzI6M10pDQogICAgICAgIGlmIGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoIi8iKToNCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfK2NhcHRjaGFfdXJsDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXysnLycrY2FwdGNoYV91cmwNCiAgICANCiAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsIHN0cihpaWQpKyJjYXB0Y2hhLmpwZyIgKQ0KICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikNCiAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybA0KICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkNCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykNCiAgICBpZiAncmVmZXInIGluIG06DQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXInXSkNCiAgICBpZiAnYWdlbnQnIGluIG06DQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkNCiAgICBpZiAnc2V0Y29va2llJyBpbiBtOg0KICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10NCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQ0KICAgICAgICANCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQ0KICAgICNvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpDQogICAgI29wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KICAgIHVybGxpYjIudXJsb3BlbihyZXEpDQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KDQogICAgbG9jYWxGaWxlLndyaXRlKHJlc3BvbnNlLnJlYWQoKSkNCiAgICByZXNwb25zZS5jbG9zZSgpDQogICAgbG9jYWxGaWxlLmNsb3NlKCkNCiAgICBzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpDQogICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkNCiAgICByZXR1cm4gc29sdXRpb24NCiAgICANCmNsYXNzIElucHV0V2luZG93KHhibWNndWkuV2luZG93RGlhbG9nKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToNCiAgICAgICAgc2VsZi5jcHRsb2MgPSBrd2FyZ3MuZ2V0KCdjYXB0Y2hhJykNCiAgICAgICAgc2VsZi5pbWcgPSB4Ym1jZ3VpLkNvbnRyb2xJbWFnZSgzMzUsMzAsNjI0LDYwLHNlbGYuY3B0bG9jKQ0KICAgICAgICBzZWxmLmFkZENvbnRyb2woc2VsZi5pbWcpDQogICAgICAgIHNlbGYua2JkID0geGJtYy5LZXlib2FyZCgpDQoNCiAgICBkZWYgZ2V0KHNlbGYpOg0KICAgICAgICBzZWxmLnNob3coKQ0KICAgICAgICB0aW1lLnNsZWVwKDIpICAgICAgICANCiAgICAgICAgc2VsZi5rYmQuZG9Nb2RhbCgpDQogICAgICAgIGlmIChzZWxmLmtiZC5pc0NvbmZpcm1lZCgpKToNCiAgICAgICAgICAgIHRleHQgPSBzZWxmLmtiZC5nZXRUZXh0KCkNCiAgICAgICAgICAgIHNlbGYuY2xvc2UoKQ0KICAgICAgICAgICAgcmV0dXJuIHRleHQNCiAgICAgICAgc2VsZi5jbG9zZSgpDQogICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA0KZGVmIGdldEVwb2NUaW1lKCk6DQogICAgaW1wb3J0IHRpbWUNCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSoxMDAwKSkNCg0KZGVmIGdldEVwb2NUaW1lMigpOg0KICAgIGltcG9ydCB0aW1lDQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkpKQ0KDQpkZWYgZ2V0X3BhcmFtcygpOg0KICAgICAgICBwYXJhbT1bXQ0KICAgICAgICBwYXJhbXN0cmluZz1zeXMuYXJndlsyXQ0KICAgICAgICBpZiBsZW4ocGFyYW1zdHJpbmcpPj0yOg0KICAgICAgICAgICAgcGFyYW1zPXN5cy5hcmd2WzJdDQogICAgICAgICAgICBjbGVhbmVkcGFyYW1zPXBhcmFtcy5yZXBsYWNlKCc/JywnJykNCiAgICAgICAgICAgIGlmIChwYXJhbXNbbGVuKHBhcmFtcyktMV09PScvJyk6DQogICAgICAgICAgICAgICAgcGFyYW1zPXBhcmFtc1swOmxlbihwYXJhbXMpLTJdDQogICAgICAgICAgICBwYWlyc29mcGFyYW1zPWNsZWFuZWRwYXJhbXMuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgcGFyYW09e30NCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihwYWlyc29mcGFyYW1zKSk6DQogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9e30NCiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz1wYWlyc29mcGFyYW1zW2ldLnNwbGl0KCc9JykNCiAgICAgICAgICAgICAgICBpZiAobGVuKHNwbGl0cGFyYW1zKSk9PTI6DQogICAgICAgICAgICAgICAgICAgIHBhcmFtW3NwbGl0cGFyYW1zWzBdXT1zcGxpdHBhcmFtc1sxXQ0KICAgICAgICByZXR1cm4gcGFyYW0NCg0KDQpkZWYgZ2V0RmF2b3JpdGVzKCk6DQogICAgICAgIGl0ZW1zID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQ0KICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykNCiAgICAgICAgZm9yIGkgaW4gaXRlbXM6DQogICAgICAgICAgICBuYW1lID0gaVswXQ0KICAgICAgICAgICAgdXJsID0gaVsxXQ0KICAgICAgICAgICAgaWNvbmltYWdlID0gaVsyXQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGZhbkFydCA9IGlbM10NCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGljb25pbWFnZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgdHJ5OiBwbGF5bGlzdCA9IGlbNV0NCiAgICAgICAgICAgIGV4Y2VwdDogcGxheWxpc3QgPSBOb25lDQogICAgICAgICAgICB0cnk6IHJlZ2V4cyA9IGlbNl0NCiAgICAgICAgICAgIGV4Y2VwdDogcmVnZXhzID0gTm9uZQ0KDQogICAgICAgICAgICBpZiBpWzRdID09IDA6DQogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuQXJ0LCcnLCcnLCcnLCdmYXYnLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLGlbNF0saWNvbmltYWdlLGZhbmFydCwnJywnJywnJywnJywnZmF2JykNCg0KDQpkZWYgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0PU5vbmUscmVnZXhzPU5vbmUpOg0KICAgICAgICBmYXZMaXN0ID0gW10NCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyArICd0eHQnKToNCiAgICAgICAgICAgIG9zLm1ha2VkaXJzKGZhdm9yaXRlcyArICd0eHQnKQ0KICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoaGlzdG9yeSk6DQogICAgICAgICAgICBvcy5tYWtlZGlycyhoaXN0b3J5KQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjIHNlZW1zIHRoYXQgYWZ0ZXINCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1GYWxzZToNCiAgICAgICAgICAgIGFkZG9uX2xvZygnTWFraW5nIEZhdm9yaXRlcyBGaWxlJykNCiAgICAgICAgICAgIGZhdkxpc3QuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3QscmVnZXhzKSkNCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcywgInciKQ0KICAgICAgICAgICAgYS53cml0ZShqc29uLmR1bXBzKGZhdkxpc3QpKQ0KICAgICAgICAgICAgYS5jbG9zZSgpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhZGRvbl9sb2coJ0FwcGVuZGluZyBGYXZvcml0ZXMnKQ0KICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkNCiAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKGEpDQogICAgICAgICAgICBkYXRhLmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlKSkNCiAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQ0KICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKGRhdGEpKQ0KICAgICAgICAgICAgYi5jbG9zZSgpDQoNCg0KZGVmIHJtRmF2b3JpdGUobmFtZSk6DQogICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpDQogICAgICAgIGZvciBpbmRleCBpbiByYW5nZShsZW4oZGF0YSkpOg0KICAgICAgICAgICAgaWYgZGF0YVtpbmRleF1bMF09PW5hbWU6DQogICAgICAgICAgICAgICAgZGVsIGRhdGFbaW5kZXhdDQogICAgICAgICAgICAgICAgYiA9IG9wZW4oZmF2b3JpdGVzLCAidyIpDQogICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKGRhdGEpKQ0KICAgICAgICAgICAgICAgIGIuY2xvc2UoKQ0KICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQ0KDQpkZWYgdXJsc29sdmVyKHVybCk6DQogICAgaWYgYWRkb24uZ2V0U2V0dGluZygnVXBkYXRlY29tbW9ucmVzb2x2ZXJzJykgPT0gJ3RydWUnOg0KICAgICAgICBsID0gb3MucGF0aC5qb2luKGhvbWUsJ2dlbmVzaXNyZXNvbHZlcnMucHknKQ0KICAgICAgICBpZiB4Ym1jdmZzLmV4aXN0cyhsKToNCiAgICAgICAgICAgIG9zLnJlbW92ZShsKQ0KDQogICAgICAgIGdlbmVzaXNfdXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9sYW1iZGE4MS9sYW1iZGEtYWRkb25zL21hc3Rlci9wbHVnaW4udmlkZW8uZ2VuZXNpcy9jb21tb25yZXNvbHZlcnMucHknDQogICAgICAgIHRoPSB1cmxsaWIudXJscmV0cmlldmUoZ2VuZXNpc191cmwsbCkNCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnVXBkYXRlY29tbW9ucmVzb2x2ZXJzJywgJ2ZhbHNlJykNCiAgICB0cnk6DQogICAgICAgIGltcG9ydCBnZW5lc2lzcmVzb2x2ZXJzDQogICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oTWF2ZXJpY2sgVFYsUGxlYXNlIGVuYWJsZSBVcGRhdGUgQ29tbW9ucmVzb2x2ZXJzIHRvIFBsYXkgaW4gU2V0dGluZ3MuIC0gLDEwMDAwKSIpDQoNCiAgICByZXNvbHZlZD1nZW5lc2lzcmVzb2x2ZXJzLmdldCh1cmwpLnJlc3VsdA0KICAgIGlmIHVybCA9PSByZXNvbHZlZCBvciByZXNvbHZlZCBpcyBOb25lOg0KICAgICAgICAjaW1wb3J0DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKE1hdmVyaWNrIFRWLElzIEZpbmRpbmcgWW91ciBMaW5rIC0gLDUwMDApIikNCiAgICAgICAgaW1wb3J0IHJlc29sdmV1cmwNCiAgICAgICAgaG9zdCA9IHJlc29sdmV1cmwuSG9zdGVkTWVkaWFGaWxlKHVybCkNCiAgICAgICAgaWYgaG9zdDoNCiAgICAgICAgICAgIHJlc29sdmVyID0gcmVzb2x2ZXVybC5yZXNvbHZlKHVybCkNCiAgICAgICAgICAgIHJlc29sdmVkID0gcmVzb2x2ZXINCiAgICBpZiByZXNvbHZlZCA6DQogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzb2x2ZWQsbGlzdCk6DQogICAgICAgICAgICBmb3IgayBpbiByZXNvbHZlZDoNCiAgICAgICAgICAgICAgICBxdWFsaXR5ID0gYWRkb24uZ2V0U2V0dGluZygncXVhbGl0eScpDQogICAgICAgICAgICAgICAgaWYga1sncXVhbGl0eSddID09ICdIRCcgIDoNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICdTRCcgOg0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddDQogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJzEwODBwJyBhbmQgYWRkb24uZ2V0U2V0dGluZygnMTA4MHBxdWFsaXR5JykgPT0gJ3RydWUnIDoNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZlZA0KICAgIHJldHVybiByZXNvbHZlcg0KZGVmIHBsYXlfcGxheWxpc3QobmFtZSwgbXVfcGxheWxpc3QpOg0KICAgICAgICBpbXBvcnQgdXJscGFyc2UNCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnOg0KICAgICAgICAgICAgbmFtZXMgPSBbXQ0KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgZF9uYW1lPXVybHBhcnNlLnVybHBhcnNlKGkpLm5ldGxvYw0KICAgICAgICAgICAgICAgIGlmIGRfbmFtZSA9PSAnJzoNCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKG5hbWUpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkNCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICAgICAgICAgIGluZGV4ID0gZGlhbG9nLnNlbGVjdCgnQ2hvb3NlIGEgdmlkZW8gc291cmNlJywgbmFtZXMpDQogICAgICAgICAgICBpZiBpbmRleCA+PSAwOg0KICAgICAgICAgICAgICAgIGlmICImbW9kZT0xOSIgaW4gbXVfcGxheWxpc3RbaW5kZXhdOg0KICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpKSkNCiAgICAgICAgICAgICAgICBlbGlmICIkZG9yZWdleCIgaW4gbXVfcGxheWxpc3RbaW5kZXhdIDoNCg0KICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBtdV9wbGF5bGlzdFtpbmRleF0uc3BsaXQoJyZyZWdleHM9JykNCg0KICAgICAgICAgICAgICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChzZXBhdGVbMV0sIHNlcGF0ZVswXSkNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB1cmwgPSBtdV9wbGF5bGlzdFtpbmRleF0NCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHBsYXlsaXN0ID0geGJtYy5QbGF5TGlzdCgxKSAjIDEgbWVhbnMgdmlkZW8NCiAgICAgICAgICAgIHBsYXlsaXN0LmNsZWFyKCkNCiAgICAgICAgICAgIGl0ZW0gPSAwDQogICAgICAgICAgICBmb3IgaSBpbiBtdV9wbGF5bGlzdDoNCiAgICAgICAgICAgICAgICBpdGVtICs9IDENCiAgICAgICAgICAgICAgICBpbmZvID0geGJtY2d1aS5MaXN0SXRlbSgnJXMpICVzJyAlKHN0cihpdGVtKSxuYW1lKSkNCiAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQoaSwgaW5mbykNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdwbGF5bGlzdC5wbGF5b2Zmc2V0KHZpZGVvLDApJykNCg0KDQpkZWYgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpOg0KICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJykgPT0gIiI6DQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbignTWF2ZXJpY2sgVFYnLCdDaG9vc2UgYSBsb2NhdGlvbiB0byBzYXZlIGZpbGVzLicsMTUwMDAsIitpY29uKyIpIikNCiAgICAgICAgICAgIGFkZG9uLm9wZW5TZXR0aW5ncygpDQogICAgICAgIHBhcmFtcyA9IHsndXJsJzogdXJsLCAnZG93bmxvYWRfcGF0aCc6IGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKX0NCiAgICAgICAgZG93bmxvYWRlci5kb3dubG9hZChuYW1lLCBwYXJhbXMpDQogICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICAgICAgcmV0ID0gZGlhbG9nLnllc25vKCdNYXZlcmljayBUVicsICdEbyB5b3Ugd2FudCB0byBhZGQgdGhpcyBmaWxlIGFzIGEgc291cmNlPycpDQogICAgICAgIGlmIHJldDoNCiAgICAgICAgICAgIGFkZFNvdXJjZShvcy5wYXRoLmpvaW4oYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpLCBuYW1lKSkNCg0KDQpkZWYgYWRkRGlyKG5hbWUsdXJsLG1vZGUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLGNyZWRpdHMsc2hvd2NvbnRleHQ9RmFsc2UpOg0KICAgICAgICANCiAgICAgICAgdT1zeXMuYXJndlswXSsiP3VybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrc3RyKG1vZGUpKyImbmFtZT0iK3VybGxpYi5xdW90ZV9wbHVzKG5hbWUpKyImaWNvbmltYWdlPSIrdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSsiJmZhbmFydD0iK3VybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkNCiAgICAgICAgb2s9VHJ1ZQ0KICAgICAgICBpZiBkYXRlID09ICcnOg0KICAgICAgICAgICAgZGF0ZSA9IE5vbmUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlDQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdEZvbGRlci5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSwgImNyZWRpdHMiOiBjcmVkaXRzIH0pDQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQ0KICAgICAgICBpZiBzaG93Y29udGV4dDoNCiAgICAgICAgICAgIGNvbnRleHRNZW51ID0gW10NCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdzb3VyY2UnOg0KICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gc3RyKFNPVVJDRVMpOg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBTb3VyY2VzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT04Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZG93bmxvYWQnOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rvd25sb2FkJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9OSZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdmYXYnOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTYmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KCQkJCQkJCQkJDQogICAgICAgICAgICBpZiBub3QgbmFtZSBpbiBGQVY6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCksIG1vZGUpKSkNCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQ0KICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LGlzRm9sZGVyPVRydWUpDQoNCiAgICAgICAgcmV0dXJuIG9rDQpkZWYgeXRkbF9kb3dubG9hZCh1cmwsdGl0bGUsbWVkaWFfdHlwZT0ndmlkZW8nKToNCiAgICAjIHBsYXkgaW4geGJtYyB3aGlsZSBwbGF5aW5nIGdvIGJhY2sgdG8gY29udGV4dE1lbnUoYykgdG8gIiEhRG93bmxvYWQhISINCiAgICAjIFRyaWFsIHlhc2NlZW46IHNlcGVyYXRlIHxVc2VyLUFnZW50PQ0KICAgIGltcG9ydCB5b3V0dWJlZGwNCiAgICBpZiBub3QgdXJsID09ICcnOg0KICAgICAgICBpZiBtZWRpYV90eXBlPT0gJ2F1ZGlvJzoNCiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUsYXVkaW89VHJ1ZSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUpICAgDQogICAgZWxpZiB4Ym1jLlBsYXllcigpLmlzUGxheWluZygpID09IFRydWUgOg0KICAgICAgICBpbXBvcnQgWURTdHJlYW1FeHRyYWN0b3INCiAgICAgICAgaWYgWURTdHJlYW1FeHRyYWN0b3IuaXNEb3dubG9hZGluZygpID09IFRydWU6DQoNCiAgICAgICAgICAgIFlEU3RyZWFtRXh0cmFjdG9yLm1hbmFnZURvd25sb2FkcygpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWMuUGxheWVyKCkuZ2V0UGxheWluZ0ZpbGUoKQ0KDQogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWNfdXJsLnNwbGl0KCd8VXNlci1BZ2VudD0nKVswXQ0KICAgICAgICAgICAgaW5mbyA9IHsndXJsJzp4Ym1jX3VybCwndGl0bGUnOnRpdGxlLCdtZWRpYV90eXBlJzptZWRpYV90eXBlfQ0KICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCgnJyxkb3dubG9hZD1UcnVlLGRsX2luZm89aW5mbykgICAgDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRE9XTkxPQUQsRmlyc3QgUGxheSBbQ09MT1IgeWVsbG93XVdISUxFIHBsYXlpbmcgZG93bmxvYWRbL0NPTE9SXSAsMTAwMDApIikNCiANCmRlZiBzZWFyY2goc2l0ZV9uYW1lLHNlYXJjaF90ZXJtPU5vbmUpOg0KICAgIHRodW1ibmFpbD0nJw0KICAgIGlmIG9zLnBhdGguZXhpc3RzKGhpc3RvcnkpID09IEZhbHNlIG9yIGFkZG9uLmdldFNldHRpbmcoJ2NsZWFyc2VhY2hoaXN0b3J5Jyk9PSd0cnVlJzoNCiAgICAgICAgU2F2ZVRvRmlsZShoaXN0b3J5LCcnKQ0KICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCJjbGVhcnNlYWNoaGlzdG9yeSIsImZhbHNlIikNCiAgICBpZiBzaXRlX25hbWUgPT0gJ2hpc3RvcnknIDoNCiAgICAgICAgY29udGVudCA9IExvYWRGaWxlKGhpc3RvcnkpDQogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnKC4rPyk6KC4qPykoPzpccnxcbiknKS5maW5kYWxsKGNvbnRlbnQpDQoNCiAgICAgICAgZm9yIG5hbWUsc2VhcmNoX3Rlcm0gaW4gbWF0Y2g6DQogICAgICAgICAgICBpZiAncGx1Z2luOi8vJyBpbiBzZWFyY2hfdGVybToNCiAgICAgICAgICAgICAgICBhZGRMaW5rKHNlYXJjaF90ZXJtLCBuYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsPWludChsZW4obWF0Y2gpKSkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUrJzonK3NlYXJjaF90ZXJtLG5hbWUsMjYsaWNvbixGQU5BUlQsJycsJycsJycsJycpDQogICAgaWYgbm90IHNlYXJjaF90ZXJtOiAgICANCiAgICAgICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKCcnLCdFbnRlciBTZWFyY2ggVGVybScpDQogICAgICAgIGtleWJvYXJkLmRvTW9kYWwoKQ0KICAgICAgICBpZiAoa2V5Ym9hcmQuaXNDb25maXJtZWQoKSA9PSBGYWxzZSk6DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgc2VhcmNoX3Rlcm0gPSBrZXlib2FyZC5nZXRUZXh0KCkNCiAgICAgICAgaWYgbGVuKHNlYXJjaF90ZXJtKSA9PSAwOg0KICAgICAgICAgICAgcmV0dXJuICAgICAgICANCiAgICBzZWFyY2hfdGVybSA9IHNlYXJjaF90ZXJtLnJlcGxhY2UoJyAnLCcrJykNCiAgICBzZWFyY2hfdGVybSA9IHNlYXJjaF90ZXJtLmVuY29kZSgndXRmLTgnKQ0KICAgIGlmICd5b3V0dWJlJyBpbiBzaXRlX25hbWU6DQogICAgICAgICN5b3V0dWJlID0geW91dHViZSNMYW5hIERlbCBSZXkNCiAgICAgICAgaW1wb3J0IF95dHBsaXN0DQoNCiAgICAgICAgc2VhcmNoX3JlcyA9IHt9DQogICAgICAgIHNlYXJjaF9yZXMgPSBfeXRwbGlzdC5Zb1VUdWJlKCdzZWFyY2hZVCcseW91dHViZT1zZWFyY2hfdGVybSxtYXhfcGFnZT00LG5vc2F2ZT0nbm9zYXZlJykNCiAgICAgICAgdG90YWwgPSBsZW4oc2VhcmNoX3JlcykNCiAgICAgICAgZm9yIGl0ZW0gaW4gc2VhcmNoX3JlczoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBuYW1lID0gc2VhcmNoX3Jlc1tpdGVtXVsndGl0bGUnXQ0KICAgICAgICAgICAgICAgIGRhdGU9IHNlYXJjaF9yZXNbaXRlbV1bJ2RhdGUnXQ0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBzZWFyY2hfcmVzW2l0ZW1dWydkZXNjJ10NCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdVTkFWQUlBQkxFJw0KDQogICAgICAgICAgICAgICAgdXJsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScgKyBzZWFyY2hfcmVzW2l0ZW1dWyd1cmwnXQ0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9J2h0dHA6Ly9pbWcueW91dHViZS5jb20vdmkvJytzZWFyY2hfcmVzW2l0ZW1dWyd1cmwnXSsnLzAuanBnJw0KICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLCBuYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgIAlhZGRvbl9sb2coICdUaGlzIGl0ZW0gaXMgaWdub3JlZDo6JykNCiAgICAgICAgcGFnZV9kYXRhID0gc2l0ZV9uYW1lICsnOicrIHNlYXJjaF90ZXJtICsgJ1xuJw0KICAgICAgICBTYXZlVG9GaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdoaXN0b3J5JykscGFnZV9kYXRhLGFwcGVuZD1UcnVlKQ0KICAgIGVsaWYgJ2Rtb3Rpb24nIGluIHNpdGVfbmFtZToNCiAgICAgICAgdXJsTWFpbiA9ICJodHRwczovL2FwaS5kYWlseW1vdGlvbi5jb20iIA0KICAgICAgICAjeW91dHViZSA9IHlvdXR1YmUjTGFuYSBEZWwgUmV5DQogICAgICAgIGltcG9ydCBfRE1zZWFyY2gNCiAgICAgICAgZmFtaWx5RmlsdGVyID0gc3RyKGFkZG9uLmdldFNldHRpbmcoJ2ZhbWlseUZpbHRlcicpKQ0KICAgICAgICBfRE1zZWFyY2gubGlzdFZpZGVvcyh1cmxNYWluKyIvdmlkZW9zP2ZpZWxkcz1kZXNjcmlwdGlvbixkdXJhdGlvbixpZCxvd25lci51c2VybmFtZSx0YWtlbl90aW1lLHRodW1ibmFpbF9sYXJnZV91cmwsdGl0bGUsdmlld3NfdG90YWwmc2VhcmNoPSIrc2VhcmNoX3Rlcm0rIiZzb3J0PXJlbGV2YW5jZSZsaW1pdD0xMDAmZmFtaWx5X2ZpbHRlcj0iK2ZhbWlseUZpbHRlcisiJmxvY2FsaXphdGlvbj1lbl9FTiZwYWdlPTEiKQ0KICAgIA0KICAgICAgICBwYWdlX2RhdGEgPSBzaXRlX25hbWUgKyc6Jysgc2VhcmNoX3Rlcm0rICdcbicNCiAgICAgICAgU2F2ZVRvRmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnaGlzdG9yeScpLHBhZ2VfZGF0YSxhcHBlbmQ9VHJ1ZSkgICAgICAgIA0KICAgIGVsaWYgJ0lNREJpZHBsYXknIGluIHNpdGVfbmFtZToNCiAgICAgICAgdXJsTWFpbiA9ICJodHRwOi8vd3d3Lm9tZGJhcGkuY29tLz90PSIgDQogICAgICAgIHVybD0gdXJsTWFpbitzZWFyY2hfdGVybQ0KDQogICAgICAgIGhlYWRlcnMgPSBkaWN0KHsnVXNlci1BZ2VudCc6J01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMzsgcnY6MzMuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8zMy4wJywnUmVmZXJlcic6ICdodHRwOi8vam9rZXIub3JnLycsJ0FjY2VwdC1FbmNvZGluZyc6J2d6aXAsIGRlZmxhdGUnLCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JywnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKid9KQ0KICAgIA0KICAgICAgICByPXJlcXVlc3RzLmdldCh1cmwsaGVhZGVycz1oZWFkZXJzKQ0KICAgICAgICBkYXRhID0gci5qc29uKCkNCiAgICAgICAgcmVzID0gZGF0YVsnUmVzcG9uc2UnXQ0KICAgICAgICBpZiByZXMgPT0gJ1RydWUnOg0KICAgICAgICAgICAgaW1kYklEID0gZGF0YVsnaW1kYklEJ10NCiAgICAgICAgICAgIG5hbWU9IGRhdGFbJ1RpdGxlJ10gKyBkYXRhWydSZWxlYXNlZCddDQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpDQogICAgICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ0NoZWNrIE1vdmllIFRpdGxlJywgJ1BMQVkgOjogJXMgPyclbmFtZSkNCiAgICAgICAgICAgIGlmIHJldDoNCiAgICAgICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS8nK2ltZGJJRCsnL3BsYXknDQogICAgICAgICAgICAgICAgcGFnZV9kYXRhID0gbmFtZSArJzonKyB1cmwrICdcbicNCiAgICAgICAgICAgICAgICBTYXZlVG9GaWxlKGhpc3RvcnkscGFnZV9kYXRhLGFwcGVuZD1UcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiB1cmwNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNpbXBsZUtvcmUsTm8gSU1EQiBtYXRjaCBmb3VuZCAsNzAwMCwiK2ljb24rIikiKQ0KIyMgTHVuYXRpeHogUHNldWRvVFYgZmVhdHVyZQ0KZGVmIGFzY2lpKHN0cmluZyk6DQogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOg0KICAgICAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6DQogICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpDQogICAgcmV0dXJuIHN0cmluZw0KZGVmIHVuaShzdHJpbmcsIGVuY29kaW5nID0gJ3V0Zi04Jyk6DQogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOg0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOg0KICAgICAgICAgICAgc3RyaW5nID0gdW5pY29kZShzdHJpbmcsIGVuY29kaW5nLCAnaWdub3JlJykNCiAgICByZXR1cm4gc3RyaW5nDQpkZWYgcmVtb3ZlTm9uQXNjaWkocyk6IHJldHVybiAiIi5qb2luKGZpbHRlcihsYW1iZGEgeDogb3JkKHgpPDEyOCwgcykpDQoNCmRlZiBzZW5kSlNPTiggY29tbWFuZCk6DQogICAgZGF0YSA9ICcnDQogICAgdHJ5Og0KICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyh1bmkoY29tbWFuZCkpDQogICAgZXhjZXB0IFVuaWNvZGVFbmNvZGVFcnJvcjoNCiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEMoYXNjaWkoY29tbWFuZCkpDQoNCiAgICByZXR1cm4gdW5pKGRhdGEpDQoNCiNoYWthbWFjIHRoYW5rcyBSb21hbl9WX00NCmRlZiBTZXRWaWV3VGh1bWJuYWlsKCk6DQogICAgc2tpbl91c2VkID0geGJtYy5nZXRTa2luRGlyKCkNCiAgICBpZiBza2luX3VzZWQgPT0gJ3NraW4uY29uZmx1ZW5jZSc6DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ0NvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApJykNCiAgICBlbGlmIHNraW5fdXNlZCA9PSAnc2tpbi5hZW9uLm5veCc6DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ0NvbnRhaW5lci5TZXRWaWV3TW9kZSg1MTEpJykgDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCknKQ0KCQ0KCQ0KZGVmIHBsdWdpbnF1ZXJ5YnlKU09OKHVybCk6DQogICAganNvbl9xdWVyeSA9IHVuaSgneyJqc29ucnBjIjoiMi4wIiwibWV0aG9kIjoiRmlsZXMuR2V0RGlyZWN0b3J5IiwicGFyYW1zIjp7ImRpcmVjdG9yeSI6IiVzIiwibWVkaWEiOiJ2aWRlbyIsInByb3BlcnRpZXMiOlsidGh1bWJuYWlsIiwidGl0bGUiLCJ5ZWFyIiwiZGF0ZWFkZGVkIiwiZmFuYXJ0IiwicmF0aW5nIiwic2Vhc29uIiwiZXBpc29kZSIsInN0dWRpbyJdfSwiaWQiOjF9JykgJXVybA0KDQogICAganNvbl9mb2xkZXJfZGV0YWlsID0ganNvbi5sb2FkcyhzZW5kSlNPTihqc29uX3F1ZXJ5KSkNCiAgICBmb3IgaSBpbiBqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddIDoNCiAgICAgICAgdXJsID0gaVsnZmlsZSddDQogICAgICAgIG5hbWUgPSByZW1vdmVOb25Bc2NpaShpWydsYWJlbCddKQ0KICAgICAgICB0aHVtYm5haWwgPSByZW1vdmVOb25Bc2NpaShpWyd0aHVtYm5haWwnXSkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgZmFuYXJ0ID0gcmVtb3ZlTm9uQXNjaWkoaVsnZmFuYXJ0J10pDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICBmYW5hcnQgPSAnJw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBkYXRlID0gaVsneWVhciddDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICBkYXRlID0gJycNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgZXBpc29kZSA9IGlbJ2VwaXNvZGUnXQ0KICAgICAgICAgICAgc2Vhc29uID0gaVsnc2Vhc29uJ10NCiAgICAgICAgICAgIGlmIGVwaXNvZGUgPT0gLTEgb3Igc2Vhc29uID09IC0xOg0KICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJycNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnW0NPTE9SIHllbGxvd10gUycgKyBzdHIoc2Vhc29uKSsnWy9DT0xPUl1bQ09MT1IgaG90cGlua10gRScgKyBzdHIoZXBpc29kZSkgKydbL0NPTE9SXScNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJycNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgc3R1ZGlvID0gaVsnc3R1ZGlvJ10NCiAgICAgICAgICAgIGlmIHN0dWRpbzoNCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG4gU3R1ZGlvOltDT0xPUiBzdGVlbGJsdWVdICcgKyBzdHVkaW9bMF0gKyAnWy9DT0xPUl0nDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICBzdHVkaW8gPSAnJw0KDQogICAgICAgIGlmIGlbJ2ZpbGV0eXBlJ10gPT0gJ2ZpbGUnOg0KICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSx0aHVtYm5haWwsZmFuYXJ0LGRlc2NyaXB0aW9uLCcnLGRhdGUsJycsTm9uZSwnJyx0b3RhbD1sZW4oanNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSkpDQogICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQ0KDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsNTMsdGh1bWJuYWlsLGZhbmFydCxkZXNjcmlwdGlvbiwnJyxkYXRlLCcnKQ0KICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikNCg0KZGVmIGFkZExpbmsodXJsLG5hbWUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLHNob3djb250ZXh0LHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCxzZXRDb29raWU9IiIpOg0KICAgICAgICAjcHJpbnQgJ3VybCxuYW1lJyx1cmwsbmFtZQ0KICAgICAgICBjb250ZXh0TWVudSA9W10NCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcpDQogICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICBvayA9IFRydWUNCiAgICAgICANCiAgICAgICAgaWYgcmVnZXhzOiANCiAgICAgICAgICAgIG1vZGUgPSAnMTcnDQogICAgICAgICAgIA0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgDQogICAgICAgIGVsaWYgIGFueSh4IGluIHVybCBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICB1cmwuc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgbW9kZSA9ICcxOScNCiAgICAgICAgICANCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgICAgICAgICAgIA0KICAgICAgICBlbGlmIHVybC5lbmRzd2l0aCgnJm1vZGU9MTgnKToNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJm1vZGU9MTgnLCcnKQ0KICAgICAgICAgICAgbW9kZSA9ICcxOCcgDQogICAgICAgICAgDQogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMyZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpIA0KICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZGxhdWRpb29ubHknKSA9PSAndHJ1ZSc6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnISFEb3dubG9hZCBbQ09MT1Igc2VhYmx1ZV1BdWRpbyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yNCZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgZWxpZiB1cmwuc3RhcnRzd2l0aCgnbWFnbmV0Oj94dD0nKSBvciAnLnRvcnJlbnQnIGluIHVybDoNCiAgICAgICAgICANCiAgICAgICAgICAgIGlmICcmJyBpbiB1cmwgYW5kIG5vdCAnJmFtcDsnIGluIHVybCA6DQogICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJyYnLCcmYW1wOycpDQogICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9wbGF5P3VyaT0nICsgdXJsDQogICAgICAgICAgICBtb2RlID0gJzEyJw0KICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIGVsc2U6IA0KICAgICAgICAgICAgbW9kZSA9ICcxMicNCiAgICAgIA0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgDQogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj8iDQogICAgICAgIHBsYXlfbGlzdCA9IEZhbHNlDQogICAgICANCiAgICAgICAgaWYgcGxheWxpc3Q6DQogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOg0KICAgICAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICB1ICs9ICJtb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMiICUodXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKQ0KICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgJ1tDT0xPUiBtYWdlbnRhXSAoJyArIHN0cihsZW4ocGxheWxpc3QpKSArICcgaXRlbXMgKVsvQ09MT1JdJw0KICAgICAgICAgICAgICAgIHBsYXlfbGlzdCA9IFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQ0KICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICB1ICs9ICImcmVnZXhzPSIrcmVnZXhzDQogICAgICAgIGlmIG5vdCBzZXRDb29raWUgPT0gJyc6DQogICAgICAgICAgICB1ICs9ICImc2V0Q29va2llPSIrdXJsbGliLnF1b3RlX3BsdXMoc2V0Q29va2llKQ0KICANCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoNCiAgICAgICAgICAgIGRhdGUgPSBOb25lDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQ0KICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSB9KQ0KICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkNCiAgICAgICAgDQogICAgICAgIGlmIChub3QgcGxheV9saXN0KSBhbmQgbm90IGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKTojICAobm90IHVybC5zdGFydHN3aXRoKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyJykpOg0KICAgICAgICAgICAgaWYgcmVnZXhzOg0KICAgICAgICAgICAgICAgIGlmICckcHlGdW5jdGlvbjpwbGF5bWVkaWEoJyBub3QgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIGFuZCAnbm90cGxheWFibGUnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgIDoNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzZXR0aW5nIGlzcGxheWFibGUnLHVybCwgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpLHVybA0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGFkZG9uX2xvZyggJ05PVCBzZXR0aW5nIGlzcGxheWFibGUnK3VybCkNCiAgICAgICANCiAgICAgICAgaWYgc2hvd2NvbnRleHQ6DQogICAgICAgICAgICBjb250ZXh0TWVudSA9IFtdDQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoDQogICAgICAgICAgICAgICAgICAgICgnUmVtb3ZlIGZyb20gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkNCiAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIGVsaWYgbm90IG5hbWUgaW4gRkFWOg0KICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgPSAoDQogICAgICAgICAgICAgICAgICAgICclcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0wJw0KICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSkNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0Og0KICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICdwbGF5bGlzdD0nK3VybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpDQogICAgICAgICAgICAgICAgaWYgcmVnZXhzOg0KICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICImcmVnZXhzPSIrcmVnZXhzDQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zKSkNCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQ0KICAgICAgIA0KICAgICAgICBpZiBub3QgcGxheWxpc3QgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6DQogICAgICAgICAgICAgICAgcGxheWxpc3RfbmFtZSA9IG5hbWUuc3BsaXQoJykgJylbMV0NCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudV8gPSBbDQogICAgICAgICAgICAgICAgICAgICgnUGxheSAnK3BsYXlsaXN0X25hbWUrJyBQbGF5TGlzdCcsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyknDQogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhwbGF5bGlzdF9uYW1lKSwgdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkpKQ0KICAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51XykNCiAgICAgICAgI3ByaW50ICdhZGRpbmcnLG5hbWUNCiAjICAgICAgIHByaW50IHVybCx0b3RhbGl0ZW1zDQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosdG90YWxJdGVtcz10b3RhbCkNCiAgICAgICAgI3ByaW50ICdhZGRlZCcsbmFtZQ0KICAgICAgICByZXR1cm4gb2sNCg0KZGVmIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQ9VHJ1ZSk6DQogICAgaWYgc2V0cmVzb2x2ZWQ6DQogICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSkNCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOm5hbWV9KQ0KICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgbGl6LnNldFBhdGgoc3RyKHVybCkpDQogICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgbGl6KQ0KICAgIGVsc2U6DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ1hCTUMuUnVuUGx1Z2luKCcrdXJsKycpJykgICAgICANCg0KDQojIyBUaGFua3MgdG8gZGFzY2hhY2thLCBhbiBlcGcgc2NyYXBlciBmb3IgaHR0cDovL2kudGVsZWJveS5jaC9wcm9ncmFtbS9zdGF0aW9uX3NlbGVjdC5waHANCiMjICBodHRwOi8vZm9ydW0ueGJtYy5vcmcvcG9zdC5waHA/cD05MzYyMjgmcG9zdGNvdW50PTEwNzYNCmRlZiBnZXRlcGcobGluayk6DQogICAgICAgIHVybD11cmxsaWIudXJsb3BlbihsaW5rKQ0KICAgICAgICBzb3VyY2U9dXJsLnJlYWQoKQ0KICAgICAgICB1cmwuY2xvc2UoKQ0KICAgICAgICBzb3VyY2UyID0gc291cmNlLnNwbGl0KCJKZXR6dCIpDQogICAgICAgIHNvdXJjZTMgPSBzb3VyY2UyWzFdLnNwbGl0KCdwcm9ncmFtbS9kZXRhaWwucGhwP2NvbnN0X2lkPScpDQogICAgICAgIHNvdXJjZXVocnplaXQgPSBzb3VyY2UzWzFdLnNwbGl0KCc8YnIgLz48YSBocmVmPSIvJykNCiAgICAgICAgbm93dGltZSA9IHNvdXJjZXVocnplaXRbMF1bNDA6bGVuKHNvdXJjZXVocnplaXRbMF0pXQ0KICAgICAgICBzb3VyY2V0aXRsZSA9IHNvdXJjZTNbMl0uc3BsaXQoIjwvYT48L3A+PC9kaXY+IikNCiAgICAgICAgbm93dGl0bGUgPSBzb3VyY2V0aXRsZVswXVsxNzpsZW4oc291cmNldGl0bGVbMF0pXQ0KICAgICAgICBub3d0aXRsZSA9IG5vd3RpdGxlLmVuY29kZSgndXRmLTgnKQ0KICAgICAgICByZXR1cm4gIiAgLSAiK25vd3RpdGxlKyIgLSAiK25vd3RpbWUNCg0KDQpkZWYgZ2V0X2VwZyh1cmwsIHJlZ2V4KToNCiAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaXRlbSA9IHJlLmZpbmRhbGwocmVnZXgsIGRhdGEpWzBdDQogICAgICAgICAgICByZXR1cm4gaXRlbQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IGZhaWxlZCcpDQogICAgICAgICAgICBhZGRvbl9sb2cocmVnZXgpDQogICAgICAgICAgICByZXR1cm4NCg0KDQp4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ21vdmllcycpDQoNCnRyeToNCiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9VTlNPUlRFRCkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfTEFCRUwpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0RBVEUpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0dFTlJFKQ0KZXhjZXB0Og0KICAgIHBhc3MNCg0KcGFyYW1zPWdldF9wYXJhbXMoKQ0KDQp1cmw9Tm9uZQ0KbmFtZT1Ob25lDQptb2RlPU5vbmUNCnBsYXlsaXN0PU5vbmUNCmljb25pbWFnZT1Ob25lDQpmYW5hcnQ9RkFOQVJUDQpwbGF5bGlzdD1Ob25lDQpmYXZfbW9kZT1Ob25lDQpyZWdleHM9Tm9uZQ0KDQp0cnk6DQogICAgdXJsPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJ1cmwiXSkuZGVjb2RlKCd1dGYtOCcpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIG5hbWU9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbIm5hbWUiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgaWNvbmltYWdlPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJpY29uaW1hZ2UiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgZmFuYXJ0PXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJmYW5hcnQiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgbW9kZT1pbnQocGFyYW1zWyJtb2RlIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHBsYXlsaXN0PWV2YWwodXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInBsYXlsaXN0Il0pLnJlcGxhY2UoJ3x8JywnLCcpKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBmYXZfbW9kZT1pbnQocGFyYW1zWyJmYXZfbW9kZSJdKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICByZWdleHM9cGFyYW1zWyJyZWdleHMiXQ0KZXhjZXB0Og0KICAgIHBhc3MNCg0KYWRkb25fbG9nKCJNb2RlOiAiK3N0cihtb2RlKSkNCmlmIG5vdCB1cmwgaXMgTm9uZToNCiAgICBhZGRvbl9sb2coIlVSTDogIitzdHIodXJsLmVuY29kZSgndXRmLTgnKSkpDQphZGRvbl9sb2coIk5hbWU6ICIrc3RyKG5hbWUpKQ0KDQppZiBtb2RlPT1Ob25lOg0KICAgIGFkZG9uX2xvZygiSW5kZXgiKQ0KICAgIFNLaW5kZXgoKQkNCg0KZWxpZiBtb2RlPT0xOg0KICAgIGFkZG9uX2xvZygiZ2V0RGF0YSIpDQogICAgZ2V0RGF0YSh1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0yOg0KICAgIGFkZG9uX2xvZygiZ2V0Q2hhbm5lbEl0ZW1zIikNCiAgICBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0zOg0KICAgIGFkZG9uX2xvZygiZ2V0U3ViQ2hhbm5lbEl0ZW1zIikNCiAgICBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT00Og0KICAgIGFkZG9uX2xvZygiZ2V0RmF2b3JpdGVzIikNCiAgICBnZXRGYXZvcml0ZXMoKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT01Og0KICAgIGFkZG9uX2xvZygiYWRkRmF2b3JpdGUiKQ0KICAgIHRyeToNCiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxmYXZfbW9kZSkNCg0KZWxpZiBtb2RlPT02Og0KICAgIGFkZG9uX2xvZygicm1GYXZvcml0ZSIpDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICB0cnk6DQogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICBybUZhdm9yaXRlKG5hbWUpDQoNCmVsaWYgbW9kZT09NzoNCiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpDQogICAgYWRkU291cmNlKHVybCkNCg0KZWxpZiBtb2RlPT04Og0KICAgIGFkZG9uX2xvZygicm1Tb3VyY2UiKQ0KICAgIHJtU291cmNlKG5hbWUpDQoNCmVsaWYgbW9kZT09OToNCiAgICBhZGRvbl9sb2coImRvd25sb2FkX2ZpbGUiKQ0KICAgIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKQ0KDQplbGlmIG1vZGU9PTEwOg0KICAgIGFkZG9uX2xvZygiZ2V0Q29tbXVuaXR5U291cmNlcyIpDQogICAgZ2V0Q29tbXVuaXR5U291cmNlcygpDQoNCmVsaWYgbW9kZT09MTE6DQogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQ0KICAgIGFkZFNvdXJjZSh1cmwpDQoNCmVsaWYgbW9kZT09MTI6DQogICAgYWRkb25fbG9nKCJzZXRSZXNvbHZlZFVybCIpDQogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4iKSBvciBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiNub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIiKSA6DQogICAgICAgIGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKHBhdGg9dXJsKQ0KICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGl0ZW0pDQogICAgZWxzZToNCiAgICAgICAgcHJpbnQgJ05vdCBzZXR0aW5nIHNldFJlc29sdmVkVXJsJw0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpDQoNCg0KZWxpZiBtb2RlPT0xMzoNCiAgICBhZGRvbl9sb2coInBsYXlfcGxheWxpc3QiKQ0KICAgIHBsYXlfcGxheWxpc3QobmFtZSwgcGxheWxpc3QpDQoNCmVsaWYgbW9kZT09MTQ6DQogICAgYWRkb25fbG9nKCJnZXRfeG1sX2RhdGFiYXNlIikNCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09MTU6DQogICAgYWRkb25fbG9nKCJicm93c2VfeG1sX2RhdGFiYXNlIikNCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCwgVHJ1ZSkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09MTY6DQogICAgYWRkb25fbG9nKCJicm93c2VfY29tbXVuaXR5IikNCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKFRydWUpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE3Og0KICAgIGFkZG9uX2xvZygiZ2V0UmVnZXhQYXJzZWQiKQ0KICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQ0KICAgIGlmIHVybDoNCiAgICAgICAgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZCkNCiAgICBlbHNlOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihNYXZlcmljayBUViAsRmFpbGVkIHRvIGV4dHJhY3QgcmVnZXguIC0gIisidGhpcyIrIiw0MDAwLCIraWNvbisiKSIpDQplbGlmIG1vZGU9PTE4Og0KICAgIGFkZG9uX2xvZygieW91dHViZWRsIikNCiAgICB0cnk6DQogICAgICAgIGltcG9ydCB5b3V0dWJlZGwNCiAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihNYXZlcmljayBUVixQbGVhc2UgW0NPTE9SIHllbGxvd11pbnN0YWxsIHRoZSBZb3V0dWJlIEFkZG9uWy9DT0xPUl0gbW9kdWxlICwxMDAwMCwiIikiKQ0KICAgIHN0cmVhbV91cmw9eW91dHViZWRsLnNpbmdsZV9ZRCh1cmwpDQogICAgcGxheXNldHJlc29sdmVkKHN0cmVhbV91cmwsbmFtZSxpY29uaW1hZ2UpDQplbGlmIG1vZGU9PTE5Og0KCWFkZG9uX2xvZygiR2VuZXNpc2NvbW1vbnJlc29sdmVycyIpDQoJcGxheXNldHJlc29sdmVkICh1cmxzb2x2ZXIodXJsKSxuYW1lLGljb25pbWFnZSxUcnVlKQkNCg0KZWxpZiBtb2RlPT0yMToNCiAgICBhZGRvbl9sb2coImRvd25sb2FkIGN1cnJlbnQgZmlsZSB1c2luZyB5b3V0dWJlLWRsIHNlcnZpY2UiKQ0KICAgIHl0ZGxfZG93bmxvYWQoJycsbmFtZSwndmlkZW8nKQ0KZWxpZiBtb2RlPT0yMzoNCiAgICBhZGRvbl9sb2coImdldCBpbmZvIHRoZW4gZG93bmxvYWQiKQ0KICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ3ZpZGVvJykgDQplbGlmIG1vZGU9PTI0Og0KICAgIGFkZG9uX2xvZygiQXVkaW8gb25seSB5b3V0dWJlIGRvd25sb2FkIikNCiAgICB5dGRsX2Rvd25sb2FkKHVybCxuYW1lLCdhdWRpbycpDQplbGlmIG1vZGU9PTI1Og0KICAgIGFkZG9uX2xvZygiWW91VHViZS9ETW90aW9uIikNCiAgICBzZWFyY2godXJsKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZT09MjY6DQogICAgYWRkb25fbG9nKCJZb3VUdWJlL0RNb3Rpb24gRnJvbSBTZWFyY2ggSGlzdG9yeSIpDQogICAgbmFtZSA9IG5hbWUuc3BsaXQoJzonKQ0KICAgIHNlYXJjaCh1cmwsc2VhcmNoX3Rlcm09bmFtZVsxXSkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGU9PTI3Og0KICAgIGFkZG9uX2xvZygiVXNpbmcgSU1EQiBpZCB0byBwbGF5IGluIFB1bHNhciIpDQogICAgcHVsc2FySU1EQj1zZWFyY2godXJsKQ0KICAgIHhibWMuUGxheWVyKCkucGxheShwdWxzYXJJTURCKSANCmVsaWYgbW9kZT09MzA6DQogICAgR2V0U3VibGlua3MobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCkNCmVsaWYgbW9kZT09MzE6DQogICAgV2l6SERNZW51KHVybCxpY29uaW1hZ2UsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZT09MzI6DQoJV2l6X0dldF91cmwodXJsKQ0KCXhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkJDQoJDQplbGlmIG1vZGU9PTQwOg0KICAgIFNlYXJjaENoYW5uZWxzKCkNCiAgICBTZXRWaWV3VGh1bWJuYWlsKCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gNDEgOiANCiAgICBTZWFyY2hfaW5wdXQodXJsKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCgkNCmVsaWYgbW9kZT09NTM6DQogICAgYWRkb25fbG9nKCJSZXF1ZXN0aW5nIEpTT04tUlBDIEl0ZW1zIikNCiAgICBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ==')
